(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function e(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=e(n);fetch(n.href,o)}})();const N={menuBackground:new URL(""+new URL("MenuBackground-DLZzkP1L.png",import.meta.url).href,import.meta.url).toString(),menuButton:new URL(""+new URL("MenuButton-DA5PBXzQ.png",import.meta.url).href,import.meta.url).toString(),mainBackground:new URL(""+new URL("BackgroundandFrame-Be8I9v-5.png",import.meta.url).href,import.meta.url).toString(),hintFrame:new URL(""+new URL("HintButtonFrame-B4QjkPso.png",import.meta.url).href,import.meta.url).toString(),hintIndicator:new URL(""+new URL("LightOn_small-DkJS4x_p.png",import.meta.url).href,import.meta.url).toString(),scrambleButton:new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAMAAAD04JH5AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAByUExURfywRtWbSuKlUNKhXd6iTd2hTeOmUeCkT9OZSdGhXN+iTtCXSM2VR9CfW8+eWt+jTuWoU9qeS+KlT+SmUdufTNugTOGkT9ugTc+XR9SaScycV86dWdGYSNKZSdOiXtacS8mYVciYVMeXU8aWU82cWAAAAKj755cAAAAmdFJOU/////////////////////////////////////////////////8Ap3qBvAAAAAlwSFlzAAAOwgAADsIBFShKgAAAABl0RVh0U29mdHdhcmUAUGFpbnQuTkVUIDUuMS4xMYoIFs4AAAC4ZVhJZklJKgAIAAAABQAaAQUAAQAAAEoAAAAbAQUAAQAAAFIAAAAoAQMAAQAAAAIAAAAxAQIAEQAAAFoAAABphwQAAQAAAGwAAAAAAAAA8nYBAOgDAADydgEA6AMAAFBhaW50Lk5FVCA1LjEuMTEAAAMAAJAHAAQAAAAwMjMwAaADAAEAAAABAAAABaAEAAEAAACWAAAAAAAAAAIAAQACAAQAAABSOTgAAgAHAAQAAAAwMTAwAAAAAFztYfoJ6Kq7AAADa0lEQVR4Xu3X6VYUQQyG4QFFFAFBUUEU3Lj/W7Sq+4WuJalOejY41vPH6aSS+s4cHIbVw571AD1AD9AD9AA9QA/wcgOsCpTdlgxyZY2+i3uIuzScsnNOcE0TR408x7lgHufRjuQIwHYTRqLisWQOMOy1Y4o5XkuMAYY1Pung+FpkCzCu8ZoGxy0iSwC2+E2TbBIYArAjR29CXcEhwXwAViRo1OgLOCCYDcCGCXUZZyq0BXMBWPCEso5zJbq1mY2MP6LaxtkcvVp7J9OgOI/zKTq15laGQdGCiQSNWmsts6BowkiKTsUagJINMxlalcZmJgeUbJjJ0avoqxkcULJhpkCzYgpAxYaZCu2SnixByYSRGv2SJQAVE0YEHCip9QkVI4Zq9EtKnaGIigODJbqFbQQImM3QKshlRiIqfsxPqBe2FyBiByjm5gJQWI49EZWcWGUgorIWVi0KQGF96rJdBVBJV3B5QGGbeoBmAJ636jkG4PaAwlb1AM86AM/btaMAB+rG3QQ4ZKN0G/8mOLvJACzsAV5KgMfjPG0CG60BhgFebcZ4e8BzYrMXabh+bwFecf3eArzm+r0F4PbV6ohCYrcBeE79FwGefhXtKwC3BxRSOw3whkJqBwGOuV58A5QAq7fveLUB3B5QyCgBohMe1jUsi4RPAS3Ae0ZOzyisgVUBhZxcPWck+kBtKdYEFHJyNZmKjqkuwYrggkrOFCC4pOF1wXxApaCUp99fiUOaHowGH6kUlAD1WzASf5Ab+IMkolJyBgg4YMNM8IlKyR3gigMmzERUKlrjhLkKfRNGIio1PZmMrgkj0QGlmjMATRNGBpQEvgD0TBgZUJKovSNmU7RMGBm0Ps31pQwnaJgwMqIm8gSQvtDI8v9DFGWeAOb3gNOgqPAFWH2m2XLFWVDV6P3py3TmC23NV849oqxqHGBDpfVhnPzyGVHXLQgQyG+D8PFNp6Fx5Jolsptzjo2+nVJPXdNsaQS4ZU048p1XPqZvcq03iT3xZfLNymzYMWs+AA/Vj9cM65fIVoAfcRGvg2GvFTPzWifvykXjbgPOWzTP1pu4oI2zNr7TwSW3aLx/QLgDBPrP4z0nHJYECM7qEDfL/pBdGGB0d/vz1+8/f2/veF5irQCb0AP0AD1AD9AD9AA9QA+w5wAPD/8ANBrEov9sMIoAAAAASUVORK5CYII=",import.meta.url).toString(),gridButton:new URL(""+new URL("Button-B2CLfsDZ.png",import.meta.url).href,import.meta.url).toString(),circularLetterFrame:new URL(""+new URL("CircularLetterFrame-CkYvd1XA.png",import.meta.url).href,import.meta.url).toString(),sapphire:new URL(""+new URL("emerald-BGbKOI70.png",import.meta.url).href,import.meta.url).toString(),ruby:new URL(""+new URL("ruby-DR_7d093.png",import.meta.url).href,import.meta.url).toString(),diamond:new URL(""+new URL("diamond-CHyP0IXF.png",import.meta.url).href,import.meta.url).toString(),fonts:{arialBold:new URL(""+new URL("arialbd-FEHhJQl7.ttf",import.meta.url).href,import.meta.url).toString()},sounds:{select:new URL(""+new URL("select_letter-sKQaRmsV.wav",import.meta.url).href,import.meta.url).toString(),place:new URL(""+new URL("place_letter-B5tfq3mA.wav",import.meta.url).href,import.meta.url).toString(),win:new URL(""+new URL("puzzle_solved-CNmPFP6L.wav",import.meta.url).href,import.meta.url).toString(),click:new URL(""+new URL("button_click-D3i_P9Ct.wav",import.meta.url).href,import.meta.url).toString(),hintUsed:new URL(""+new URL("button_click-D3i_P9Ct.wav",import.meta.url).href,import.meta.url).toString(),error:new URL(""+new URL("hint_used-CKITXbRV.mp3",import.meta.url).href,import.meta.url).toString()},music:[new URL(""+new URL("track1-D5Cx8o1J.mp3",import.meta.url).href,import.meta.url).toString(),new URL(""+new URL("track2-BllHWJ1v.mp3",import.meta.url).href,import.meta.url).toString(),new URL(""+new URL("track3-BVgx_gWX.mp3",import.meta.url).href,import.meta.url).toString(),new URL(""+new URL("track2-BllHWJ1v.mp3",import.meta.url).href,import.meta.url).toString(),new URL(""+new URL("track5-udI9VZkE.mp3",import.meta.url).href,import.meta.url).toString()],wordsCsv:new URL(""+new URL("words_processed-XaCKYsME.csv",import.meta.url).href,import.meta.url).toString()},b=1e3,H=800,he=40,ue=20,W=40,z=5,ht=10,Nt=4,ce=5,de=.75,Bt=.95,fe=80,ge=125,me=80,pe=40,ut=3,Se=4,Te=7,Ae=12,xe=15,bt=5,ye=2,Be=3,we=5,_e=7,Ie=10,Le=120,Ht=35,Re=20,ct=250,J=75,U=70,st=10,Ee=0,Ft=0,Pe=5,Me=7,Ce=10,ve=20,Oe=1.8,Ne=2.8,be=-50,He=-90,Gt=20,dt=.4,Fe=1.3,wt=300,_t=180,Ge=40,We=7,Ue=420,De=50,ze=6,ke=12,Xe=5,ft=50,Ve=10,Ye=8,Ze=6,Qe=5,qe=22,je=26,Je=.7,Ke=1.35,$e=10,Wt=3,ti=.95,ei=.95,ii=35,si=20,nt={x:90,y:122,width:815,height:273},Ut={x:110,y:475,width:245,height:245},gt={x:374,y:450,width:285,height:285},ni={x:660,y:500,width:243,height:195},It={x:50,y:10,height:30},Dt=2,zt=2,mt=10,oi=3,ri=15,pt=18,li=.08,ai=.2,hi=16,Lt=1.8,kt=1.25,Xt=68,ui=26,ci=25,Vt=18,Yt=28;var ot=(a=>(a.Grid="Grid",a.Score="Score",a))(ot||{}),$=(a=>(a.Playing="Playing",a.Solved="Solved",a))($||{}),I=(a=>(a.MainMenu="MainMenu",a.CasualMenu="CasualMenu",a.CompetitiveMenu="CompetitiveMenu",a.Playing="Playing",a.GameOver="GameOver",a.SessionComplete="SessionComplete",a))(I||{}),C=(a=>(a.None="None",a.Easy="Easy",a.Medium="Medium",a.Hard="Hard",a))(C||{}),Z=(a=>(a.RevealFirst="RevealFirst",a.RevealRandom="RevealRandom",a.RevealLast="RevealLast",a.RevealFirstOfEach="RevealFirstOfEach",a))(Z||{});const s=(a,t,e,i=255)=>({r:a,g:t,b:e,a:i}),Zt=()=>{const a=[],t={winBg:s(30,37,51),decorBase:s(45,52,67),decorAccent1:s(208,232,242),decorAccent2:s(155,211,255),gridEmptyTile:s(100,110,120,180),gridFilledTile:s(155,211,255),gridLetter:s(255,190,70),wheelBg:s(45,52,67,150),wheelOutline:s(155,211,255),letterCircleNormal:s(240,240,240,220),letterCircleHighlight:s(34,161,57,230),letterTextNormal:s(30,37,51),letterTextHighlight:s(255,255,255),dragLine:s(0,105,255,200),continueButton:s(100,200,100),hudTextGuess:s(155,211,255),hudTextFound:s(255,100,0),hudTextSolved:s(155,211,255),solvedOverlayBg:s(40,50,70,210),scoreBarBg:s(45,52,67,230),scoreTextLabel:s(255,190,70),scoreTextValue:s(255,190,70),menuBg:s(40,50,70,210),menuTitleText:s(208,232,242),menuButtonNormal:s(80,90,110),menuButtonHover:s(120,135,150),menuButtonText:s(255,255,255)};a.push(t);const e={winBg:s(46,34,53),decorBase:s(69,48,78),decorAccent1:s(236,150,127),decorAccent2:s(255,199,138),gridEmptyTile:s(100,80,90,180),gridFilledTile:s(217,95,67),gridLetter:s(255,255,255),wheelBg:s(69,48,78,150),wheelOutline:s(236,150,127),letterCircleNormal:s(255,255,255,220),letterCircleHighlight:s(217,95,67,230),letterTextNormal:s(46,34,53),letterTextHighlight:s(255,255,255),dragLine:s(247,156,41,200),continueButton:s(217,95,67),hudTextGuess:s(255,199,138),hudTextFound:s(255,199,138),hudTextSolved:s(247,156,41),solvedOverlayBg:s(69,48,78,220),scoreBarBg:s(69,48,78,230),scoreTextLabel:s(255,190,70),scoreTextValue:s(255,190,70),menuBg:s(69,48,78,210),menuTitleText:s(236,150,127),menuButtonNormal:s(100,80,90),menuButtonHover:s(130,110,120),menuButtonText:s(255,255,255)};a.push(e);const i={winBg:s(61,44,33),decorBase:s(94,68,54),decorAccent1:s(245,235,220),decorAccent2:s(218,145,70),gridEmptyTile:s(188,169,147,180),gridFilledTile:s(218,145,70),gridLetter:s(245,235,220),wheelBg:s(138,104,73,150),wheelOutline:s(245,235,220),letterCircleNormal:s(245,235,220,220),letterCircleHighlight:s(218,145,70,230),letterTextNormal:s(61,44,33),letterTextHighlight:s(61,44,33),dragLine:s(245,235,220,200),continueButton:s(218,145,70),hudTextGuess:s(245,235,220),hudTextFound:s(245,235,220),hudTextSolved:s(245,235,220),solvedOverlayBg:s(94,68,54,210),scoreBarBg:s(94,68,54,230),scoreTextLabel:s(255,190,70),scoreTextValue:s(255,190,70),menuBg:s(94,68,54,210),menuTitleText:s(245,235,220),menuButtonNormal:s(138,104,73),menuButtonHover:s(168,148,121),menuButtonText:s(245,235,220)};a.push(i);const n={winBg:s(25,20,35),decorBase:s(40,35,50),decorAccent1:s(0,255,255),decorAccent2:s(255,0,255),gridEmptyTile:s(60,60,70,180),gridFilledTile:s(255,0,255),gridLetter:s(255,255,255),wheelBg:s(50,50,60,150),wheelOutline:s(0,255,255),letterCircleNormal:s(70,60,80,220),letterCircleHighlight:s(0,255,255,230),letterTextNormal:s(255,255,0),letterTextHighlight:s(25,20,35),dragLine:s(255,255,0,200),continueButton:s(255,0,255),hudTextGuess:s(0,255,255),hudTextFound:s(0,255,255),hudTextSolved:s(255,255,0),solvedOverlayBg:s(40,35,50,220),scoreBarBg:s(40,35,50,230),scoreTextLabel:s(255,190,70),scoreTextValue:s(255,190,70),menuBg:s(40,35,50,210),menuTitleText:s(0,255,255),menuButtonNormal:s(70,60,80),menuButtonHover:s(100,90,110),menuButtonText:s(255,255,0)};a.push(n);const o={winBg:s(40,40,40),decorBase:s(70,70,70),decorAccent1:s(150,150,150),decorAccent2:s(220,220,220),gridEmptyTile:s(100,100,100,180),gridFilledTile:s(180,180,180),gridLetter:s(255,255,255),wheelBg:s(60,60,60,150),wheelOutline:s(180,180,180),letterCircleNormal:s(190,190,190,220),letterCircleHighlight:s(100,150,200,230),letterTextNormal:s(0,0,0),letterTextHighlight:s(255,255,255),dragLine:s(100,150,200,200),continueButton:s(100,150,200),hudTextGuess:s(255,255,255),hudTextFound:s(255,255,255),hudTextSolved:s(100,150,200),solvedOverlayBg:s(70,70,70,210),scoreBarBg:s(70,70,70,230),scoreTextLabel:s(255,190,70),scoreTextValue:s(255,190,70),menuBg:s(70,70,70,210),menuTitleText:s(220,220,220),menuButtonNormal:s(100,100,100),menuButtonHover:s(130,130,130),menuButtonText:s(255,255,255)};a.push(o);const l={winBg:s(105,184,110),decorBase:s(245,247,22),decorAccent1:s(255,190,200,230),decorAccent2:s(255,255,200),gridEmptyTile:s(190,205,195,180),gridFilledTile:s(90,170,100),gridLetter:s(190,205,195),wheelBg:s(180,220,190,150),wheelOutline:s(110,160,120),letterCircleNormal:s(240,255,245,220),letterCircleHighlight:s(255,190,200,230),letterTextNormal:s(40,70,45),letterTextHighlight:s(40,70,45),dragLine:s(80,180,90,200),continueButton:s(90,170,100),hudTextGuess:s(50,100,55),hudTextFound:s(50,100,55),hudTextSolved:s(0,180,0),solvedOverlayBg:s(180,220,190,210),scoreBarBg:s(170,210,180,230),scoreTextLabel:s(255,190,70),scoreTextValue:s(255,190,70),menuBg:s(180,220,190,220),menuTitleText:s(40,70,45),menuButtonNormal:s(140,190,150),menuButtonHover:s(110,160,120),menuButtonText:s(40,70,45)};a.push(l);const r={winBg:s(15,25,45),decorBase:s(20,35,60),decorAccent1:s(35,55,85),decorAccent2:s(0,130,140),gridEmptyTile:s(50,60,80,180),gridFilledTile:s(0,180,170),gridLetter:s(210,245,255),wheelBg:s(40,60,90,150),wheelOutline:s(80,120,180),letterCircleNormal:s(190,210,225,220),letterCircleHighlight:s(0,180,170,230),letterTextNormal:s(15,25,45),letterTextHighlight:s(15,25,45),dragLine:s(0,200,190,200),continueButton:s(0,150,130),hudTextGuess:s(180,230,240),hudTextFound:s(180,230,240),hudTextSolved:s(50,220,210),solvedOverlayBg:s(25,40,65,210),scoreBarBg:s(35,55,85,230),scoreTextLabel:s(255,190,70),scoreTextValue:s(255,190,70),menuBg:s(25,40,65,220),menuTitleText:s(210,245,255),menuButtonNormal:s(50,80,120),menuButtonHover:s(80,120,180),menuButtonText:s(210,245,255)};a.push(r);const h={winBg:s(78,156,199),decorBase:s(225,225,215),decorAccent1:s(205,205,195),decorAccent2:s(185,185,175),gridEmptyTile:s(154,199,198,180),gridFilledTile:s(255,255,255),gridLetter:s(0,0,0),wheelBg:s(215,215,205,150),wheelOutline:s(140,140,130),letterCircleNormal:s(255,255,255,220),letterCircleHighlight:s(190,210,240,230),letterTextNormal:s(0,0,0),letterTextHighlight:s(0,0,0),dragLine:s(80,80,80,200),continueButton:s(90,90,90),hudTextGuess:s(181,179,152),hudTextFound:s(40,40,40),hudTextSolved:s(0,100,0),solvedOverlayBg:s(215,215,205,210),scoreBarBg:s(205,205,195,230),scoreTextLabel:s(255,190,70),scoreTextValue:s(255,190,70),menuBg:s(215,215,205,220),menuTitleText:s(20,20,20),menuButtonNormal:s(170,170,160),menuButtonHover:s(140,140,130),menuButtonText:s(20,20,20)};a.push(h);const d={winBg:s(55,30,15),decorBase:s(85,50,25),decorAccent1:s(125,70,35),decorAccent2:s(190,80,30),gridEmptyTile:s(100,70,45,180),gridFilledTile:s(200,100,30),gridLetter:s(255,245,210),wheelBg:s(75,45,20,150),wheelOutline:s(140,90,50),letterCircleNormal:s(240,230,200,220),letterCircleHighlight:s(230,130,40,230),letterTextNormal:s(55,30,15),letterTextHighlight:s(55,30,15),dragLine:s(230,130,40,200),continueButton:s(180,90,25),hudTextGuess:s(255,225,180),hudTextFound:s(255,225,180),hudTextSolved:s(255,150,0),solvedOverlayBg:s(85,50,25,210),scoreBarBg:s(85,50,25,230),scoreTextLabel:s(255,190,70),scoreTextValue:s(255,190,70),menuBg:s(85,50,25,220),menuTitleText:s(255,245,210),menuButtonNormal:s(125,70,35),menuButtonHover:s(155,90,45),menuButtonText:s(255,245,210)};return a.push(d),a},di=Math.PI,Qt=a=>a*di/180,Rt=(a,t)=>{const e=a.x-t.x,i=a.y-t.y;return e*e+i*i},Y=(a,t,e)=>Math.max(t,Math.min(e,a)),St=(a,t,e)=>a+(t-a)*e,B=(a,t,e=!1)=>{const i=Math.random()*(t-a)+a;return e?Math.floor(i):i},Et=a=>{for(let t=a.length-1;t>0;t-=1){const e=Math.floor(Math.random()*(t+1));[a[t],a[e]]=[a[e],a[t]]}return a},v=(a,t)=>t.x>=a.x&&t.x<=a.x+a.width&&t.y>=a.y&&t.y<=a.y+a.height,P=a=>{const t=a.a??255,e=Math.max(0,Math.min(1,t/255));return`rgba(${a.r}, ${a.g}, ${a.b}, ${e})`},G=a=>a.trim(),fi=a=>{const t=[];let e="",i=!1;for(let n=0;n<a.length;n+=1){const o=a[n];o==='"'?i&&n+1<a.length&&a[n+1]==='"'?(e+='"',n+=1):i=!i:o===","&&!i?(t.push(e),e=""):e+=o}return t.push(e),t},gi=a=>{const t=a.split(/\r?\n/),e=[];let i="",n=!1;for(const o of t){i&&(i+=`
`),i+=o;for(let l=0;l<o.length;l+=1)o[l]==='"'&&(n&&l+1<o.length&&o[l+1]==='"'?l+=1:n=!n);n||(e.push(i),i="")}return i&&e.push(i),e},mi=()=>({text:"",rarity:0,pos:"",definition:"",sentence:"",avgSubLen:0,countGE3:0,countGE4:0,countGE5:0,easyValidCount:0,mediumValidCount:0,hardValidCount:0}),pi=async a=>{const t=await fetch(a);if(!t.ok)throw new Error(`Failed to load word list: ${t.status} ${t.statusText}`);const e=await t.text(),i=gi(e);if(i.length<=1)return[];const n=[];for(let o=1;o<i.length;o+=1){const l=i[o];if(l.trim())try{const r=fi(l),h=mi();r.length>0&&(h.text=G(r[0]).toLowerCase()),r.length>1&&(h.rarity=parseInt(G(r[1])||"0",10)),r.length>2&&(h.pos=G(r[2])),r.length>3&&(h.definition=G(r[3])),r.length>4&&(h.sentence=G(r[4])),r.length>5&&(h.avgSubLen=parseFloat(G(r[5])||"0")),r.length>6&&(h.countGE3=parseInt(G(r[6])||"0",10)),r.length>7&&(h.countGE4=parseInt(G(r[7])||"0",10)),r.length>8&&(h.countGE5=parseInt(G(r[8])||"0",10)),r.length>9&&(h.easyValidCount=parseInt(G(r[9])||"0",10)),r.length>10&&(h.mediumValidCount=parseInt(G(r[10])||"0",10)),r.length>11&&(h.hardValidCount=parseInt(G(r[11])||"0",10)),h.text&&n.push(h)}catch(r){console.warn("Skipping malformed word record",r)}}return n},Si=(a,t)=>a.filter(e=>e.text.length===t),Ti=(a,t)=>{if(!a)return[];const e=a.toLowerCase(),i=new Map;for(const o of e)i.set(o,(i.get(o)??0)+1);const n=[];for(const o of t){const l=o.text.toLowerCase();if(!l||l.length>e.length||l===e)continue;const r=new Map;let h=!0;for(const d of l)if(r.set(d,(r.get(d)??0)+1),(i.get(d)??0)<(r.get(d)??0)){h=!1;break}h&&n.push(o)}return n},Ai=a=>[...a].sort((t,e)=>t.text.length!==e.text.length?t.text.length-e.text.length:t.text.localeCompare(e.text,void 0,{sensitivity:"base"}));class xi{constructor(t=25){this.targetCount=t}shapes=[];update(t,e,i){for(;this.shapes.length<this.targetCount;)this.spawn(e,i.decorBase,i.decorAccent1,i.decorAccent2);for(const n of this.shapes)n.pos={x:n.pos.x+n.vel.x*t,y:n.pos.y+n.vel.y*t},n.vel.x>0&&n.pos.x-n.size>e.x?(n.pos.x=-n.size-B(50,150),n.pos.y=B(0,e.y)):n.vel.x<0&&n.pos.x+n.size<0&&(n.pos.x=e.x+n.size+B(50,150),n.pos.y=B(0,e.y)),n.pos.y-n.size>e.y?n.pos.y=-n.size:n.pos.y+n.size<0&&(n.pos.y=e.y+n.size)}draw(t){for(const e of this.shapes){if(t.save(),t.fillStyle=P(e.color),e.kind==="Circle")t.beginPath(),t.arc(e.pos.x,e.pos.y,e.size,0,Math.PI*2),t.fill();else if(e.kind==="Triangle"){const i=[];for(let n=0;n<3;n+=1){const o=Qt(e.rot+n*120);i.push({x:e.pos.x+Math.cos(o)*e.size,y:e.pos.y+Math.sin(o)*e.size})}t.beginPath(),t.moveTo(i[0].x,i[0].y),t.lineTo(i[1].x,i[1].y),t.lineTo(i[2].x,i[2].y),t.closePath(),t.fill()}else e.kind==="Line"&&(t.translate(e.pos.x,e.pos.y),t.rotate(Qt(e.rot)),t.fillRect(-e.size/2,-1,e.size,2));t.restore()}}spawn(t,e,i,n){const o=B(0,1,!0)===0,l=B(0,2,!0),r=["Circle","Triangle","Line"][l]??"Circle",h=B(0,t.y),d=o?-B(50,200):t.x+B(50,200),c={kind:r,pos:{x:d,y:h},vel:{x:(o?1:-1)*B(15,45),y:0},size:0,rot:B(0,360),color:e};r==="Circle"?(c.size=B(50,120),c.color={...e,a:B(60,100,!0)}):r==="Triangle"?(c.size=B(40,150),c.color={...i,a:B(30,60,!0)}):(c.size=B(80,180),c.color={...n,a:B(80,140,!0)}),this.shapes.push(c)}}const k=(a,t,e,i,n,o,l,r,h=1)=>{const d=Math.min(o,i/2,n/2);a.beginPath(),a.moveTo(t+d,e),a.arcTo(t+i,e,t+i,e+n,d),a.arcTo(t+i,e+n,t,e+n,d),a.arcTo(t,e+n,t,e,d),a.arcTo(t,e,t+i,e,d),a.closePath(),l&&(a.fillStyle=P(l),a.fill()),r&&(a.strokeStyle=P(r),a.lineWidth=h,a.stroke())},et=(a,t,e,i,n)=>{a.save(),a.font=n,a.fillStyle=P(i),a.textAlign="center",a.textBaseline="middle",a.fillText(t,e.x,e.y),a.restore()},yi=(a,t,e)=>{if(e<=0)return t;const i=t.split(/\s+/).filter(Boolean);let n="";const o=[],l=()=>{n&&(o.push(n),n="")};for(const r of i){const h=n?`${n} ${r}`:r;if(a.measureText(h).width>e&&n)l(),n=r;else if(a.measureText(h).width>e&&!n){let d="";for(const c of r){const u=d+c;a.measureText(u).width>e&&d&&(o.push(d),d=""),d+=c}d&&o.push(d)}else n=h}return l(),o.join(`
`)},qt=(a,t,e)=>e<=0?t:t.split(/\r?\n/).map(n=>yi(a,n,e)).join(`
`),jt=(a,t,e,i)=>{const n=Math.min(a/e,t/i),o=e*n,l=i*n,r={x:(a-o)/2,y:(t-l)/2};return{scale:n,offset:r,designSize:{x:e,y:i},screenSize:{x:a,y:t},viewport:{x:r.x,y:r.y,width:o,height:l}}},Bi=(a,t,e=1)=>{a.setTransform(t.scale*e,0,0,t.scale*e,t.offset.x*e,t.offset.y*e)},wi=(a,t)=>({x:(t.x-a.offset.x)/a.scale,y:(t.y-a.offset.y)/a.scale}),Jt=["Letter","Random","Full Word","1st of Each"],_i=75,Ii=.33,Li=.5,Ri=.15,Ei=.46,Pi=.55,Mi=2,Kt=20,Ci=4,vi=5,Pt=20,$t=5,Oi=5,Tt=[ye,Be,we,_e],Ni=[Z.RevealFirst,Z.RevealRandom,Z.RevealLast,Z.RevealFirstOfEach],bi=["This hint will reveal the next available letter.","This hint will reveal one random letter for each word.","This hint will reveal the last word that hasn't been revealed.","This hint will reveal the first unrevealed letter for every word."],X={r:255,g:190,b:70,a:255},K={r:255,g:255,b:255,a:255};class Hi{constructor(t,e){this.canvas=t,this.ctx=e,this.attachInput(),this.init().catch(i=>{this.loadingError=i instanceof Error?i.message:"Failed to initialize game."})}width=0;height=0;view=jt(1,1,b,H);uiScale=1;fontFamily="WordPuzzleFont";dpr=1;ready=!1;loadingError=null;hasUserInteracted=!1;images={};sounds={};backgroundMusic=null;themes=[];currentTheme=Zt()[0];decor=new xi(10);currentScreen=I.MainMenu;gameState=$.Playing;mousePos={x:0,y:0};fullWordList=[];roots=[];base="";solutions=[];sorted=[];grid=[];allPotentialSolutions=[];found=new Set;foundBonusWords=new Set;usedBaseWordsThisSession=new Set;usedLetterSetsThisSession=new Set;hintPoints=0;hintsAvailable=0;wordsSolvedSinceHint=0;currentScore=0;puzzlesPerSession=0;currentPuzzleIndex=0;isInSession=!1;selectedDifficulty=C.None;bonusWordsPopupScrollOffset=0;bonusWordsPopupMaxScrollOffset=0;cachedBonusWords=[];bonusWordsCacheIsValid=!1;bonusTextFlourishTimer=0;hintFrameClickAnimTimers=[0,0,0,0];hintClickableRegions=[];hoveredHintIndex=-1;isHoveringHintPointsText=!1;hoveredSolvedWordIndex=-1;dragging=!1;path=[];currentGuess="";letterPositionRadius=0;visualBgRadius=0;wheelLetterRenderPos=[];currentWheelRadius=0;currentLetterRenderRadius=0;wheelCenter={x:0,y:0};wheelTouchScaleActive=!1;gridStartX=0;gridStartY=0;currentGridLayoutScale=1;wordCol=[];wordRow=[];colMaxLen=[];colXOffset=[];scoreFlourishes=[];hintPointAnims=[];scoreFlourishTimer=0;gridFlourishes=[];letterAnims=[];confetti=[];balloons=[];celebrationTimer=0;mainMenuButtons=[];casualMenuButtons=[];returnToMenuButton={x:0,y:0,width:0,height:0};continueButton={x:0,y:0,width:0,height:0};scrambleButton={x:0,y:0,width:0,height:0};bonusWordsTextRect={x:0,y:0,width:0,height:0};onResize(t,e,i=1){this.width=t,this.height=e,this.dpr=i,this.view=jt(t,e,b,H),this.uiScale=Y(Math.min(t/b,e/H),.65,1.6),this.updateLayout()}update(t){if(this.ready){this.decor.update(t,{x:b,y:H},this.currentTheme),this.scoreFlourishTimer>0&&(this.scoreFlourishTimer=Math.max(0,this.scoreFlourishTimer-t)),this.bonusTextFlourishTimer>0&&(this.bonusTextFlourishTimer=Math.max(0,this.bonusTextFlourishTimer-t)),this.gridFlourishes=this.gridFlourishes.filter(e=>(e.timer-=t,e.timer>0));for(let e=0;e<this.hintFrameClickAnimTimers.length;e+=1)this.hintFrameClickAnimTimers[e]>0&&(this.hintFrameClickAnimTimers[e]=Math.max(0,this.hintFrameClickAnimTimers[e]-t));if(this.updateLetterAnims(t),this.updateScoreFlourishes(t),this.updateHintPointAnims(t),this.updateCelebrationEffects(t),this.currentScreen===I.Playing||this.currentScreen===I.GameOver){this.hoveredHintIndex=-1;for(let e=0;e<this.hintClickableRegions.length;e+=1)if(v(this.hintClickableRegions[e],this.mousePos)){this.hoveredHintIndex=e;break}if(this.isHoveringHintPointsText=v(this.bonusWordsTextRect,this.mousePos),this.hoveredSolvedWordIndex=-1,this.sorted.length>0&&this.grid.length>0&&this.found.size>0){const e=W*this.currentGridLayoutScale;for(let i=0;i<this.sorted.length&&i<this.grid.length;i+=1)if(this.found.has(this.sorted[i].text)){for(let n=0;n<this.sorted[i].text.length&&n<this.grid[i].length;n+=1){const o=this.tilePos(i,n),l={x:o.x,y:o.y,width:e,height:e};if(v(l,this.mousePos)){this.hoveredSolvedWordIndex=i;break}}if(this.hoveredSolvedWordIndex!==-1)break}}}else this.hoveredHintIndex=-1,this.isHoveringHintPointsText=!1,this.bonusWordsPopupScrollOffset=0,this.hoveredSolvedWordIndex=-1}}render(){const t=this.ctx;if(t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,this.canvas.width,this.canvas.height),t.setTransform(this.dpr,0,0,this.dpr,0,0),t.fillStyle="#000",t.fillRect(0,0,this.width,this.height),this.loadingError){t.fillStyle="#fff",t.font="18px sans-serif",t.fillText(this.loadingError,20,30);return}if(!this.ready){t.fillStyle="#fff",t.font="18px sans-serif",t.fillText("Loading...",20,30);return}Bi(t,this.view,this.dpr),t.fillStyle=P(this.currentTheme.winBg),t.fillRect(0,0,b,H),this.drawBackground(t),this.currentScreen===I.MainMenu?this.renderMainMenu(t):this.currentScreen===I.CasualMenu?this.renderCasualMenu(t):this.currentScreen===I.SessionComplete?this.renderSessionComplete(t):this.renderGameScreen(t),this.isHoveringHintPointsText&&(this.currentScreen===I.Playing||this.currentScreen===I.GameOver)&&this.renderBonusWordsPopup(t)}async init(){this.themes=Zt(),this.currentTheme=this.themes[0]??this.currentTheme,await Promise.all([this.loadFont(),this.loadImages(),this.loadSounds(),this.loadWords()]),this.ready=!0,this.updateLayout()}async loadFont(){const t=new FontFace(this.fontFamily,`url(${N.fonts.arialBold})`);await t.load(),document.fonts.add(t)}async loadImages(){const t={menuBackground:N.menuBackground,menuButton:N.menuButton,mainBackground:N.mainBackground,hintFrame:N.hintFrame,hintIndicator:N.hintIndicator,scrambleButton:N.scrambleButton,gridButton:N.gridButton,circularLetterFrame:N.circularLetterFrame,sapphire:N.sapphire,ruby:N.ruby,diamond:N.diamond},e=Object.entries(t);await Promise.all(e.map(async([i,n])=>{this.images[i]=await this.loadImage(n)}))}async loadSounds(){const t=Object.entries(N.sounds);for(const[e,i]of t){const n=new Audio(i);n.preload="auto",this.sounds[e]=n}}async loadWords(){this.fullWordList=await pi(N.wordsCsv),this.roots=[];const t=[4,5,6,7];for(const e of t)this.roots.push(...Si(this.fullWordList,e))}async loadImage(t){const e=new Image;return e.src=t,await e.decode().catch(()=>new Promise((i,n)=>{e.onload=()=>i(),e.onerror=()=>n(new Error(`Failed to load image ${t}`))})),e}attachInput(){const t=o=>{this.hasUserInteracted=!0;const l=this.eventToWorld(o);this.mousePos=l,this.canvas.setPointerCapture(o.pointerId),this.handlePointerDown(l,o.pointerType)},e=o=>{const l=this.eventToWorld(o);this.mousePos=l,this.handlePointerMove(l,o.pointerType)},i=o=>{const l=this.eventToWorld(o);this.mousePos=l,this.canvas.releasePointerCapture(o.pointerId),this.handlePointerUp(l,o.pointerType)},n=o=>{this.isHoveringHintPointsText&&(this.bonusWordsPopupScrollOffset=Y(this.bonusWordsPopupScrollOffset+Math.sign(o.deltaY)*ii,0,this.bonusWordsPopupMaxScrollOffset),o.preventDefault())};this.canvas.addEventListener("pointerdown",t),this.canvas.addEventListener("pointermove",e),this.canvas.addEventListener("pointerup",i),this.canvas.addEventListener("wheel",n,{passive:!1})}eventToWorld(t){const e=this.canvas.getBoundingClientRect(),i=t.clientX-e.left,n=t.clientY-e.top;return wi(this.view,{x:i,y:n})}handlePointerDown(t,e){if(this.ready){if(this.updateWheelTouchScale(t,e),this.currentScreen===I.MainMenu){this.handleMainMenuInput(t);return}if(this.currentScreen===I.CasualMenu){this.handleCasualMenuInput(t);return}if(this.currentScreen===I.SessionComplete){v(this.continueButton,t)&&(this.playSound("click"),this.confetti=[],this.balloons=[],this.currentScreen=I.MainMenu,this.isInSession=!1,this.selectedDifficulty=C.None);return}if(this.currentScreen===I.GameOver){v(this.continueButton,t)&&this.handleContinue();return}if(v(this.returnToMenuButton,t)){this.playSound("click"),this.currentScreen=I.MainMenu,this.isInSession=!1,this.selectedDifficulty=C.None,this.clearDragState();return}if(v(this.scrambleButton,t)){this.playSound("click"),this.base=Et(this.base.split("")).join(""),this.updateLayout(),this.clearDragState();return}for(let i=0;i<this.hintClickableRegions.length;i+=1)if(v(this.hintClickableRegions[i],t)){this.hintFrameClickAnimTimers[i]=.15,this.hintPoints>=Tt[i]?(this.hintPoints-=Tt[i],this.activateHint(Ni[i])):this.playSound("error");return}for(let i=0;i<this.base.length;i+=1){const n=this.wheelLetterRenderPos[i];if(n&&Rt(t,n)<this.currentLetterRenderRadius*this.currentLetterRenderRadius){this.dragging=!0,this.path=[i],this.currentGuess=this.base[i].toUpperCase(),this.playSound("select");return}}}}handlePointerMove(t,e){if(this.updateWheelTouchScale(t,e),!!this.dragging)for(let i=0;i<this.base.length;i+=1){const n=this.wheelLetterRenderPos[i];if(n&&Rt(t,n)<this.currentLetterRenderRadius*this.currentLetterRenderRadius){const o=i;this.path.indexOf(o)===-1?(this.path.push(o),this.currentGuess+=this.base[i].toUpperCase(),this.playSound("select")):this.path.length>=2&&this.path[this.path.length-2]===o&&(this.path.pop(),this.currentGuess=this.currentGuess.slice(0,-1));break}}}handlePointerUp(t,e){if(this.wheelTouchScaleActive=!1,!this.dragging)return;if(this.currentGuess.length<3){this.clearDragState();return}let n=!1;for(let o=0;o<this.sorted.length;o+=1){const l=this.sorted[o].text.toUpperCase();if(l===this.currentGuess){if(this.found.has(this.sorted[o].text)){for(let r=0;r<l.length;r+=1)this.gridFlourishes.push({wordIdx:o,charIdx:r,timer:.6});this.playSound("place"),n=!0}else{this.found.add(this.sorted[o].text);const r=this.currentGuess.length*10,h=this.sorted[o].rarity>1?this.sorted[o].rarity*25:0,d=r+h;this.currentScore+=d,this.spawnScoreFlourish(d,o),this.scoreFlourishTimer=dt;for(let c=0;c<this.currentGuess.length;c+=1)if(c<this.path.length){const u=this.path[c],g=this.wheelLetterRenderPos[u],m=this.tilePos(o,c),S=W*this.currentGridLayoutScale*(this.currentGridLayoutScale<1?Bt:1);this.letterAnims.push({ch:this.currentGuess[c],start:g,end:{x:m.x+S/2,y:m.y+S/2},t:0-c*.03,wordIdx:o,charIdx:c,target:ot.Grid})}this.found.size===this.solutions.length&&(this.gameState=$.Solved,this.currentScreen=I.GameOver),n=!0}break}}if(!n){for(const o of this.allPotentialSolutions)if(o.text.toUpperCase()===this.currentGuess){if(this.foundBonusWords.has(o.text))this.bonusTextFlourishTimer=.6,this.playSound("place");else{this.foundBonusWords.add(o.text);const l=o.text.length;let r=0;l===3?r=1:l===4?r=2:l===5?r=3:l>=6&&(r=4),r>0&&(this.hintPoints+=r,this.spawnHintPointAnimation(this.bonusWordsTextRect,r)),this.playSound("place")}n=!0;break}}n||this.playSound("error"),this.clearDragState()}getWheelTouchRadius(t=1){const e=this.currentLetterRenderRadius*Lt*t;return this.letterPositionRadius+e}updateWheelTouchScale(t,e){if(!this.ready||!this.base||this.base.length===0){this.wheelTouchScaleActive=!1;return}if(e!=="touch"){this.wheelTouchScaleActive=!1;return}if(this.currentScreen!==I.Playing&&this.currentScreen!==I.GameOver){this.wheelTouchScaleActive=!1;return}const i=this.wheelTouchScaleActive?kt:1,n=this.getWheelTouchRadius(i);this.wheelTouchScaleActive=Rt(t,this.wheelCenter)<=n*n}handleMainMenuInput(t){if(!(this.mainMenuButtons.length<3)){if(v(this.mainMenuButtons[0],t)){this.playSound("click"),this.currentScreen=I.CasualMenu;return}if(v(this.mainMenuButtons[1],t)){this.playSound("click"),this.currentScreen=I.CasualMenu;return}v(this.mainMenuButtons[2],t)&&(this.playSound("click"),this.currentScreen=I.MainMenu)}}handleCasualMenuInput(t){if(this.casualMenuButtons.length<4)return;const[e,i,n,o]=this.casualMenuButtons;if(v(o,t)){this.playSound("click"),this.currentScreen=I.MainMenu;return}let l=C.None,r=0;v(e,t)?(l=C.Easy,r=Pe):v(i,t)?(l=C.Medium,r=Me):v(n,t)&&(l=C.Hard,r=Ce),l!==C.None&&(this.playSound("click"),this.selectedDifficulty=l,this.puzzlesPerSession=r,this.currentPuzzleIndex=0,this.isInSession=!0,this.usedBaseWordsThisSession.clear(),this.usedLetterSetsThisSession.clear(),this.rebuild(),this.currentScreen=I.Playing)}handleContinue(){this.isInSession?this.currentPuzzleIndex+1<this.puzzlesPerSession?(this.currentPuzzleIndex+=1,this.rebuild(),this.currentScreen=I.Playing):(this.currentScreen=I.SessionComplete,this.startCelebrationEffects()):this.currentScreen=I.MainMenu}rebuild(){this.themes.length>0&&(this.currentTheme=this.themes[Math.floor(Math.random()*this.themes.length)]);const t=this.getCriteriaForCurrentPuzzle();let e=0,i=ut;switch(this.selectedDifficulty){case C.Easy:e=Te,i=ut;break;case C.Medium:e=Ae,i=ut;break;case C.Hard:e=xe,i=Se;break;default:e=999,i=ut;break}let n="",o="",l=!1;const r=Et([...this.roots]),h=[],d=[],c=[];for(let m=0;m<r.length;m+=1){const S=r[m];if(!t.allowedLengths.includes(S.text.length)||!t.allowedRarities.includes(S.rarity)||this.usedBaseWordsThisSession.has(S.text))continue;const y=this.getCanonicalLetters(S.text);if(this.usedLetterSetsThisSession.has(y))continue;let w=S.countGE4;this.selectedDifficulty===C.Easy&&(w=S.easyValidCount),this.selectedDifficulty===C.Medium&&(w=S.mediumValidCount),this.selectedDifficulty===C.Hard&&(w=S.hardValidCount),w>=bt?h.push(m):d.push(m)}const u=m=>m[Math.floor(Math.random()*m.length)];if(h.length>0)n=r[u(h)].text,l=!0;else if(d.length>0)n=r[u(d)].text,l=!0;else{for(let m=0;m<r.length;m+=1){const S=r[m];if(this.usedBaseWordsThisSession.has(S.text))continue;const y=this.getCanonicalLetters(S.text);this.usedLetterSetsThisSession.has(y)||c.push(m)}c.length>0?(n=r[u(c)].text,l=!0):r.length>0&&(n=r[0].text,l=!0)}if(l&&n){const m=this.getCanonicalLetters(n);this.usedBaseWordsThisSession.add(n),this.usedLetterSetsThisSession.add(m)}this.base=n||"ERROR",o=n,this.base!=="ERROR"&&(this.base=Et(this.base.split("")).join(""));let g=[];if(this.base!=="ERROR"){this.allPotentialSolutions=Ti(this.base,this.fullWordList);const m=this.selectedDifficulty===C.Easy?[1,2]:this.selectedDifficulty===C.Medium?[1,2,3]:this.selectedDifficulty===C.Hard?[2,3,4]:[1,2,3,4],S=this.allPotentialSolutions.filter(x=>x.text.length<i?!1:m.includes(x.rarity)),y=new Map;for(const x of S)y.has(x.text)||y.set(x.text,x);const w=Array.from(y.values()).sort((x,R)=>x.text.length!==R.text.length?R.text.length-x.text.length:x.rarity!==R.rarity?x.rarity-R.rarity:x.text.localeCompare(R.text));if(w.length>e&&(w.length=e),g=[...w],o){const x=o.toLowerCase();if(!g.some(R=>R.text===x)){const R=this.roots.find(T=>T.text===x)??this.fullWordList.find(T=>T.text===x)??{text:x,rarity:0,pos:"",definition:"",sentence:"",avgSubLen:0,countGE3:0,countGE4:0,countGE5:0,easyValidCount:0,mediumValidCount:0,hardValidCount:0};R.text.length>=i&&g.push(R)}}const E=Math.min(bt,e);if(g.length<E){const x=new Set(g.map(T=>T.text)),R=this.allPotentialSolutions.filter(T=>T.text.length>=i&&!x.has(T.text)).sort((T,f)=>T.text.length!==f.text.length?f.text.length-T.text.length:T.rarity!==f.rarity?T.rarity-f.rarity:T.text.localeCompare(f.text));for(const T of R)if(g.push(T),x.add(T.text),g.length>=E)break}}else this.allPotentialSolutions=[];this.solutions=g,this.sorted=Ai(this.solutions),this.grid=this.sorted.map(m=>Array(m.text.length).fill("_")),this.found.clear(),this.foundBonusWords.clear(),this.letterAnims=[],this.scoreFlourishes=[],this.hintPointAnims=[],this.gridFlourishes=[],this.gameState=$.Playing,this.bonusWordsCacheIsValid=!1,this.bonusWordsPopupScrollOffset=0,this.currentPuzzleIndex===0&&this.isInSession?(this.currentScore=0,this.wordsSolvedSinceHint=0):this.isInSession&&(this.wordsSolvedSinceHint=0),this.updateLayout()}updateLayout(){this.updateMenuLayout(),this.updateGridLayout(),this.updateWheelLayout(),this.updateHintLayout(),this.updateTopBarLayout()}updateMenuLayout(){const e=this.scale(36)+10,i=ct+U*2+Ee,n=3,o=U*2+e+n*J+(n-1)*st+Ft,l=(b-i)/2,r=(H-o)/2;this.mainMenuButtons=[];for(let u=0;u<n;u+=1){const g=l+U,m=r+U+e+u*(J+st);this.mainMenuButtons.push({x:g,y:m,width:ct,height:J})}const h=4,d=U*2+e+h*J+(h-1)*st+Ft,c=(H-d)/2;this.casualMenuButtons=[];for(let u=0;u<h;u+=1){const g=l+U,m=c+U+e+u*(J+st);this.casualMenuButtons.push({x:g,y:m,width:ct,height:J})}}updateGridLayout(){const t=nt.x+Dt,e=nt.y+zt,i=nt.width-2*Dt,n=nt.height-2*zt,o=this.sorted.length||1;let l=1,r=o,h=1;if(this.sorted.length>0){const d=Math.min(8,o);let c=1,u=o,g=Number.POSITIVE_INFINITY;for(let p=1;p<=d;p+=1){const _=Math.ceil(o/p),M=Array(p).fill(0);for(let O=0;O<o;O+=1){const D=Math.floor(O/_);M[D]=Math.max(M[D],this.sorted[O].text.length)}let Q=0;for(const O of M){const D=O*(W+z)-(O>0?z:0);Q+=Math.max(0,D)}Q+=(p-1)*ht,Q<g&&(g=Q,c=p,u=_)}l=c,r=u;const m=5;r>m&&(r=m,l=Math.ceil(o/r)),this.colMaxLen=Array(l).fill(0);for(let p=0;p<o;p+=1){const _=Math.min(l-1,Math.floor(p/r));this.colMaxLen[_]=Math.max(this.colMaxLen[_],this.sorted[p].text.length)}let S=0;for(let p=0;p<l;p+=1){const _=this.colMaxLen[p],M=_*(W+z)-(_>0?z:0);S+=Math.max(0,M)}S+=(l-1)*ht;const y=r*(W+z)-(r>0?z:0),w=S>0?Math.min(1,i/S):1,E=y>0?Math.min(1,n/y):1;h=Math.min(w,E);const x=W*h,R=z*h,T=ht*h;this.colXOffset=[];let f=0;for(let p=0;p<l;p+=1){this.colXOffset[p]=f;const _=this.colMaxLen[p],M=_*(x+R)-(_>0?R:0);f+=Math.max(0,M)+T}const L=f-(l>0?T:0),A=r*(x+R)-(r>0?R:0);this.gridStartX=t+(i-L)/2,this.gridStartY=e+(n-A)/2;for(let p=0;p<this.colXOffset.length;p+=1)this.colXOffset[p]+=this.gridStartX;this.wordCol=[],this.wordRow=[];for(let p=0;p<o;p+=1){const _=Math.min(l-1,Math.floor(p/r)),M=p%r;this.wordCol[p]=_,this.wordRow[p]=M}}this.currentGridLayoutScale=h}updateWheelLayout(){const t=gt.x+mt,e=gt.y+mt,i=gt.width-2*mt,n=gt.height-2*mt;this.wheelCenter={x:t+i/2,y:e+n/2};const o=Math.min(i/2,n/2);if(this.currentWheelRadius=Math.max(Math.min(o,Xt),ri*1.5),this.base.length>0){let h=Math.PI*this.currentWheelRadius/this.base.length;h*=.75;const d=this.currentWheelRadius/Xt,c=pt*d;let u=Math.min(h,c);const g=this.currentWheelRadius*li,m=this.currentWheelRadius*ai;u=Y(u,g,m),this.currentLetterRenderRadius=Math.max(u,5)}else this.currentLetterRenderRadius=pt;this.letterPositionRadius=Math.max(this.currentWheelRadius,this.currentLetterRenderRadius*.5,this.currentWheelRadius*.3);const l=this.currentLetterRenderRadius/pt;if(this.visualBgRadius=this.letterPositionRadius+this.currentLetterRenderRadius+oi*l,this.wheelLetterRenderPos=[],this.base.length>0){const h=Math.PI*2/this.base.length;for(let d=0;d<this.base.length;d+=1){const c=d*h-Math.PI/2;this.wheelLetterRenderPos.push({x:this.wheelCenter.x+this.letterPositionRadius*Math.cos(c),y:this.wheelCenter.y+this.letterPositionRadius*Math.sin(c)})}}const r=pe;this.scrambleButton={x:this.wheelCenter.x+fe,y:this.wheelCenter.y+ge-r/2,width:r,height:r},this.continueButton={x:this.wheelCenter.x-100,y:this.wheelCenter.y+this.visualBgRadius+me,width:200,height:50}}updateHintLayout(){this.hintClickableRegions=[];const t=Ut,e=Jt.length,i=Mi,n=this.images.hintFrame,o=n?.naturalWidth||n?.width||0,l=n?.naturalHeight||n?.height||0,r=Pt;let h=t.y+$t+r+Oi;const d=Math.max(0,t.width-Ci*2),c=Math.max(0,t.y+t.height-h-vi);if(d<=0||c<=0)return;let u=d,g=(c-(e-1)*i)/Math.max(1,e);if(o>0&&l>0){let S=d/o,y=l*S,w=o*S;if(e*y+(e-1)*i>c&&c>0){const x=(c-(e-1)*i)/e,R=Math.max(x,Kt);S=R/l,w=o*S,y=R}u=w,g=y}else g=Math.max(g,Kt);const m=t.x+(t.width-u)/2;for(let S=0;S<e;S+=1)this.hintClickableRegions.push({x:m,y:h,width:u,height:g}),h+=g+i}updateTopBarLayout(){this.returnToMenuButton={x:It.x+Re,y:It.y+(It.height-Ht)/2,width:Le,height:Ht}}renderMainMenu(t){const e="Word Puzzle",i=[{label:"Casual",rect:this.mainMenuButtons[0]},{label:"Competitive",rect:this.mainMenuButtons[1]},{label:"Quit",rect:this.mainMenuButtons[2]}];this.drawMenuPanel(t,e,i)}renderCasualMenu(t){const e="Select Difficulty",i=[{label:"Easy",rect:this.casualMenuButtons[0]},{label:"Medium",rect:this.casualMenuButtons[1]},{label:"Hard",rect:this.casualMenuButtons[2]},{label:"Return",rect:this.casualMenuButtons[3]}];this.drawMenuPanel(t,e,i)}renderSessionComplete(t){t.save(),t.fillStyle=P({r:0,g:0,b:0,a:150}),t.fillRect(0,0,b,H),t.restore();const e=`Final Score: ${this.currentScore}`;et(t,e,{x:b/2,y:H*.3},{r:255,g:255,b:0,a:255},this.font(48,!0)),this.renderCelebrationEffects(t);const i=200,n=50,o=b/2-i/2,l=H*.8-n/2;this.continueButton={x:o,y:l,width:i,height:n};const r=v(this.continueButton,this.mousePos);this.drawButton(t,this.continueButton,"Continue",r?this.currentTheme.menuButtonHover:this.currentTheme.menuButtonNormal,K)}renderGameScreen(t){if(this.renderTopBar(t),this.renderScoreZone(t),this.renderGrid(t),this.renderPath(t),this.renderWheel(t),this.renderLetterAnims(t),this.renderScoreFlourishes(t),this.renderHintPointAnims(t),this.renderGuessDisplay(t),this.renderHintZone(t),this.renderSolvedWordPopup(t),this.gameState===$.Solved||this.currentScreen===I.GameOver){const e="Puzzle Solved!",i=this.font(24,!0);t.save(),t.font=i;const n=t.measureText(e),o=(n.actualBoundingBoxAscent??0)+(n.actualBoundingBoxDescent??0)||24;t.restore();const l=260,r=75,h=Math.max(n.width,l)+50,d=o+r+70,c=b/2-h/2,u=H/2-d/2;this.images.menuBackground?t.drawImage(this.images.menuBackground,c,u,h,d):k(t,c,u,h,d,15,this.currentTheme.solvedOverlayBg,this.currentTheme.menuButtonHover,1),et(t,e,{x:b/2,y:u+24+o/2},K,i),this.continueButton={x:b/2-l/2,y:u+o+35,width:l,height:r};const g=v(this.continueButton,this.mousePos);this.drawButton(t,this.continueButton,"Continue",g?this.currentTheme.menuButtonHover:this.currentTheme.menuButtonNormal,K)}}renderTopBar(t){if(this.currentScreen!==I.Playing&&this.currentScreen!==I.GameOver)return;const e=v(this.returnToMenuButton,this.mousePos);this.drawButton(t,this.returnToMenuButton,"Menu",e?this.currentTheme.menuButtonHover:this.currentTheme.menuButtonNormal)}renderScoreZone(t){const e=ni,i={x:e.x+e.width/2,y:e.y+ui};et(t,"SCORE:",i,X,this.font(Vt,!0));const n=i.y+ci+Vt,o=this.scoreFlourishTimer>0?1+Fe*Math.sin((dt-this.scoreFlourishTimer)/dt*Math.PI):1;if(t.save(),t.translate(e.x+e.width/2,n+Yt/2),t.scale(o,o),t.fillStyle=P(X),t.font=this.font(Yt,!0),t.textAlign="center",t.textBaseline="middle",t.fillText(`${this.currentScore}`,0,0),t.restore(),this.isInSession){const r=e.width-90,h=Ie,d=e.x+45,c=e.y+e.height-h-40,u=this.puzzlesPerSession>0?(this.currentPuzzleIndex+1)/this.puzzlesPerSession:0;k(t,d,c,r,h,4,{r:50,g:50,b:50,a:150},this.currentTheme.scoreTextLabel,1),t.fillStyle=P(X),t.fillRect(d,c,r*u,h),et(t,`${this.currentPuzzleIndex+1}/${this.puzzlesPerSession}`,{x:d+r/2,y:c+h/2},X,this.font(12,!0))}}renderGrid(t){if(this.sorted.length===0)return;const e=W*this.currentGridLayoutScale,i=z*this.currentGridLayoutScale,n=this.images.gridButton;for(let o=0;o<this.sorted.length;o+=1)for(let l=0;l<this.sorted[o].text.length;l+=1){const r=this.tilePos(o,l);if(n?t.drawImage(n,r.x,r.y,e,e):k(t,r.x,r.y,e,e,4,this.currentTheme.gridEmptyTile),!(this.grid[o]?.[l]!=="_")){const u=this.sorted[o].rarity,g=u===2?this.images.sapphire:u===3?this.images.ruby:u===4?this.images.diamond:null;if(g){const m=e*.6;t.drawImage(g,r.x+e/2-m/2,r.y+e/2-m/2,m,m)}continue}if(this.letterAnims.some(u=>u.target===ot.Grid&&u.wordIdx===o&&u.charIdx===l&&u.t<1))continue;let c=1;for(const u of this.gridFlourishes)if(u.wordIdx===o&&u.charIdx===l){const g=(.6-u.timer)/.6;c=1+.4*Math.sin(g*Math.PI);break}t.save(),t.translate(r.x+e/2,r.y+e/2),t.scale(c,c),t.fillStyle=P(X),t.font=this.font(Math.max(8,20*this.currentGridLayoutScale),!0),t.textAlign="center",t.textBaseline="middle",t.fillText(this.grid[o][l],0,0),t.restore()}if(this.colXOffset.length>=2){const l=ce*(e+i)-i;for(let r=0;r<this.colXOffset.length-1;r+=1){const h=this.colXOffset[r+1]-ht*this.currentGridLayoutScale/2;t.fillStyle="rgba(120,100,80,0.8)",t.fillRect(h-Nt/2,this.gridStartY,Nt,l)}}}renderPath(t){if(!(!this.dragging||this.path.length===0)){t.strokeStyle=P(X),t.lineWidth=5,t.lineCap="round",t.beginPath();for(let e=0;e<this.path.length;e+=1){const i=this.wheelLetterRenderPos[this.path[e]];i&&(e===0?t.moveTo(i.x,i.y):t.lineTo(i.x,i.y))}t.lineTo(this.mousePos.x,this.mousePos.y),t.stroke()}}renderWheel(t){if(!this.base)return;const e=this.images.circularLetterFrame,i=this.wheelTouchScaleActive?kt:1,n=this.currentLetterRenderRadius*Lt*i,o=Y(this.currentLetterRenderRadius/pt*Lt,.5,2),l=Math.max(8,hi*o*i);for(let r=0;r<this.base.length;r+=1){const h=this.wheelLetterRenderPos[r];if(h){if(e){const d=n*2;t.drawImage(e,h.x-d/2,h.y-d/2,d,d)}else t.beginPath(),t.arc(h.x,h.y,n,0,Math.PI*2),t.fillStyle=P(this.currentTheme.letterCircleNormal),t.fill(),t.strokeStyle=P(this.currentTheme.wheelOutline),t.lineWidth=2*i,t.stroke();t.fillStyle=P(X),t.font=this.font(l,!0),t.textAlign="center",t.textBaseline="middle",t.fillText(this.base[r].toUpperCase(),h.x,h.y)}}this.images.scrambleButton&&t.drawImage(this.images.scrambleButton,this.scrambleButton.x,this.scrambleButton.y,this.scrambleButton.width,this.scrambleButton.height)}renderLetterAnims(t){const e=Math.max(8,20*this.uiScale);for(const i of this.letterAnims){if(i.t<0)continue;const n=Y(i.t,0,1),o=n*n*(3-2*n),l=St(i.start.x,i.end.x,o),r=St(i.start.y,i.end.y,o),h=n>.7?(1-n)/.3:1;t.fillStyle=`rgba(255, 190, 70, ${h})`,t.font=this.font(e,!0),t.textAlign="center",t.textBaseline="middle",t.fillText(i.ch,l,r)}}renderScoreFlourishes(t){const e=Math.max(8,ve*this.uiScale);for(const i of this.scoreFlourishes)t.fillStyle=P(i.color),t.font=this.font(e,!0),t.textAlign="center",t.textBaseline="middle",t.fillText(i.textString,i.position.x,i.position.y)}renderHintPointAnims(t){for(const i of this.hintPointAnims)t.fillStyle=P(i.color),t.font=this.font(20,!0),t.textAlign="center",t.textBaseline="middle",t.fillText(i.textString,i.currentPosition.x,i.currentPosition.y)}renderGuessDisplay(t){if(!this.currentGuess)return;const e=this.currentGuess.length,i=W*this.currentGridLayoutScale*1.25,n=z*this.currentGridLayoutScale,o=e*i+(e-1)*n,r=this.wheelCenter.y-this.visualBgRadius-i-he-ue,h=this.wheelCenter.x-o/2,d=this.images.gridButton;for(let c=0;c<e;c+=1){const u=h+c*(i+n);d?t.drawImage(d,u,r,i,i):k(t,u,r,i,i,4,this.currentTheme.gridEmptyTile),t.fillStyle=P(X),t.font=this.font(Math.max(8,i*.65),!0),t.textAlign="center",t.textBaseline="middle",t.fillText(this.currentGuess[c],u+i/2,r+i/2)}}renderHintZone(t){const e=Ut,i=this.calculateTotalPossibleBonusWords(),n=`Bonus Words: ${this.foundBonusWords.size}/${i}`;t.font=this.font(Pt,!0),t.fillStyle=P(X),t.textAlign="left",t.textBaseline="top";const o=t.measureText(n).width,l=t.measureText(n),r=(l.actualBoundingBoxAscent??0)+(l.actualBoundingBoxDescent??0)||Pt,h=e.x+(e.width-o)/2,d=e.y+$t;t.fillText(n,h,d),this.bonusWordsTextRect={x:h,y:d,width:o,height:r};for(let c=0;c<this.hintClickableRegions.length;c+=1){const u=this.hintClickableRegions[c],m=this.hoveredHintIndex===c?this.currentTheme.menuButtonHover:this.currentTheme.menuButtonNormal,S=this.images.hintFrame,y=S?.naturalWidth||S?.width||u.width,w=S?.naturalHeight||S?.height||u.height,E=y>0?u.width/y:1;this.images.hintFrame?(t.drawImage(this.images.hintFrame,u.x,u.y,u.width,u.height),this.hintFrameClickAnimTimers[c]>0&&(t.fillStyle="rgba(0,255,0,0.2)",t.fillRect(u.x,u.y,u.width,u.height))):k(t,u.x,u.y,u.width,u.height,6,m);const x=Jt[c],R=Tt[c],T=Math.max(8,_i*E);t.fillStyle=P(X),t.font=this.font(T,!0),t.textAlign="left",t.textBaseline="middle";const f=u.x+y*Ii*E,L=u.y+w*Li*E;if(t.fillText(x,f,L),this.images.hintIndicator){const A=w*Pi*E,p=u.x+y*Ri*E,_=u.y+w*Ei*E;t.globalAlpha=this.hintPoints>=R?1:.3,t.drawImage(this.images.hintIndicator,p-A/2,_-A/2,A,A),t.globalAlpha=1}}if(this.hoveredHintIndex>=0){const c=this.hintClickableRegions[this.hoveredHintIndex],u=c.x+c.width+10,g=c.y;this.images.menuBackground?t.drawImage(this.images.menuBackground,u,g,wt,_t):k(t,u,g,wt,_t,8,this.currentTheme.menuBg,this.currentTheme.menuButtonHover,1);const m=bi[this.hoveredHintIndex],S=Ge,y=wt-S*2,w=_t-S*2,E=14,x=12,R=We,T=A=>{const p=Math.max(8,E*A),_=Math.max(8,x*A),M=R*A;t.font=this.font(_);const O=qt(t,m,y).split(`
`).filter(At=>At.length>0),D=["Available Points:",`${this.hintPoints}`,`Cost: ${Tt[this.hoveredHintIndex]}`],rt=D.length*p+Math.max(0,D.length-1)*M,V=O.length*_+Math.max(0,O.length-1)*M,j=rt+(O.length>0?M+V:0);return{headerFont:p,descFont:_,spacing:M,descLines:O,headerLines:D,headerHeight:rt,totalHeight:j}};let f=T(1);if(f.totalHeight>w){const A=Math.max(.6,w/f.totalHeight);f=T(A)}if(f.totalHeight>w&&f.descLines.length>0){const A=w-(f.headerHeight+f.spacing),p=f.descFont+f.spacing,_=Math.max(1,Math.floor((A+f.spacing)/p));f.descLines=f.descLines.slice(0,_)}t.fillStyle=P(K),t.textAlign="left",t.textBaseline="top";let L=g+S;t.font=this.font(f.headerFont,!0);for(let A=0;A<f.headerLines.length;A+=1)t.fillText(f.headerLines[A],u+S,L),L+=f.headerFont,A<f.headerLines.length-1&&(L+=f.spacing);if(f.descLines.length>0){L+=f.spacing,t.font=this.font(f.descFont);for(let A=0;A<f.descLines.length;A+=1)t.fillText(f.descLines[A],u+S,L),L+=f.descFont,A<f.descLines.length-1&&(L+=f.spacing)}}}renderBonusWordsPopup(t){const e=nt,i=e.width*ti,n=e.height*ei,o=e.x+(e.width-i)/2,l=e.y+(e.height-n)/2;this.images.menuBackground?t.drawImage(this.images.menuBackground,o,l,i,n):k(t,o,l,i,n,$e,this.currentTheme.menuBg,this.currentTheme.menuButtonHover,1);const r=this.buildBonusWordGroups();if(r.length===0)return;const h=i-ft*2,d=n-ft*2,c=f=>{const L=Math.max(5,qe*f),A=Math.max(7,je*f),p=Ve*f,_=Ye*f,M=Ze*f,Q=Qe*f,O=r.map(V=>{t.font=this.font(A,!0);const j=t.measureText(V.title).width,At=A;t.font=this.font(L);let lt=0;const tt=V.words.map(F=>{const at=F.found?F.text.toUpperCase():"*".repeat(F.text.length);return lt=Math.max(lt,t.measureText(at).width),{text:at,color:F.found?this.currentTheme.hudTextFound:this.currentTheme.menuButtonText}});let q=1;tt.length>=15?q=Wt:tt.length>=6&&(q=Math.min(2,Wt));const xt=Array.from({length:q},()=>[]),ne=Math.floor(tt.length/q),oe=tt.length%q;let yt=0;for(let F=0;F<q;F+=1){const at=ne+(F<oe?1:0);for(let Ot=0;Ot<at&&!(yt>=tt.length);Ot+=1)xt[F].push(tt[yt]),yt+=1}const Ct=xt.map(F=>F.length===0?0:F.length*L+(F.length-1)*Q),vt=Ct.length?Math.max(...Ct):0,re=q*lt+(q-1)*_,le=Math.max(j,re),ae=At+M+vt;return{title:V.title,totalWidth:le,totalHeight:ae,wordsHeight:vt,wordColumnWidth:Math.max(lt,1),columns:xt}}),D=O.reduce((V,j)=>V+j.totalWidth,0)+Math.max(0,O.length-1)*p,rt=O.reduce((V,j)=>Math.max(V,j.totalHeight),0);return{layouts:O,totalWidth:D,maxGroupHeight:rt,wordFontSize:L,titleFontSize:A,majorSpacing:p,minorSpacing:_,titleBottomMargin:M,wordLineSpacing:Q}};let u=c(1),g=1;u.totalWidth>0&&h>0&&(g=Math.min(g,h/u.totalWidth)),u.maxGroupHeight>0&&d>0&&(g=Math.min(g,d/u.maxGroupHeight)),g=Y(g,Je,Ke),g!==1&&(u=c(g));const m=o+(i-u.totalWidth)/2,S=l+ft;t.textAlign="center",t.textBaseline="top",t.font=this.font(u.titleFontSize,!0),t.fillStyle=P(K);let y=m;for(const f of u.layouts){const L=y+f.totalWidth/2;t.fillText(f.title,L,S),y+=f.totalWidth+u.majorSpacing}const w=u.titleFontSize+u.titleBottomMargin,E=ft+w,x=Math.max(1,n-E-si),R=u.layouts.reduce((f,L)=>Math.max(f,L.wordsHeight),0);this.bonusWordsPopupMaxScrollOffset=Math.max(0,R-x),this.bonusWordsPopupScrollOffset=Y(this.bonusWordsPopupScrollOffset,0,this.bonusWordsPopupMaxScrollOffset);const T=l+E-this.bonusWordsPopupScrollOffset;t.save(),t.beginPath(),t.rect(o,l+E,i,x),t.clip(),t.font=this.font(u.wordFontSize),t.textAlign="center",t.textBaseline="top",y=m;for(const f of u.layouts){let L=y;for(const A of f.columns){let p=T;for(let _=0;_<A.length;_+=1){t.fillStyle=P(K);const M=L+f.wordColumnWidth/2;t.fillText(A[_].text,M,p),p+=u.wordFontSize,_<A.length-1&&(p+=u.wordLineSpacing)}L+=f.wordColumnWidth+u.minorSpacing}y+=f.totalWidth+u.majorSpacing}t.restore()}renderSolvedWordPopup(t){if(this.hoveredSolvedWordIndex<0)return;const e=this.sorted[this.hoveredSolvedWordIndex];if(!e)return;const i=De,n=Ue,o=ze,l=Math.max(120,n-i*2),r=Math.max(10,16),h=Math.max(8,14),c=[{text:`Word: ${e.text}`,fontSize:r,bold:!0,color:{r:230,g:230,b:230,a:255}},{text:`POS: ${e.pos?e.pos:"N/A"}`,fontSize:h,bold:!1,color:{r:200,g:210,b:220,a:255}},{text:`Definition: ${e.definition?e.definition:"N/A"}`,fontSize:h,bold:!1,color:{r:190,g:200,b:210,a:255}},{text:`Sentence: ${e.sentence?e.sentence:"N/A"}`,fontSize:h,bold:!1,color:{r:190,g:200,b:210,a:255}}].map(T=>{t.font=this.font(T.fontSize,T.bold);const L=qt(t,T.text,l).split(`
`),A=L.reduce((_,M)=>Math.max(_,t.measureText(M).width),0),p=L.length*T.fontSize+Math.max(0,L.length-1)*o;return{...T,lines:L,width:A,height:p}}),u=c.reduce((T,f)=>Math.max(T,f.width),0),g=Math.min(n,u+i*2),m=c.reduce((T,f)=>T+f.height,0)+o*Math.max(0,c.length-1)+i*2,S=ke,y=Xe;let w=this.mousePos.x+S,E=this.mousePos.y+S;w+g>b-y&&(w=b-g-y),E+m>H-y&&(E=H-m-y),w=Math.max(w,y),E=Math.max(E,y),t.save(),this.images.menuBackground?t.drawImage(this.images.menuBackground,w,E,g,m):k(t,w,E,g,m,8,this.currentTheme.menuBg,this.currentTheme.menuButtonHover,1);let x=E+i;const R=w+i;t.textAlign="left",t.textBaseline="top";for(let T=0;T<c.length;T+=1){const f=c[T];t.font=this.font(f.fontSize,f.bold),t.fillStyle=P(K);let L=x;for(const A of f.lines)t.fillText(A,R,L),L+=f.fontSize+o;x+=f.height+(T<c.length-1?o:0)}t.restore()}buildBonusWordLines(){if(!this.bonusWordsCacheIsValid){const i=new Map;for(const n of this.allPotentialSolutions)this.isGridSolution(n.text)||i.set(n.text,n);this.cachedBonusWords=Array.from(i.values()).sort((n,o)=>n.text.length!==o.text.length?n.text.length-o.text.length:n.text.localeCompare(o.text)),this.bonusWordsCacheIsValid=!0}const t=[];let e=0;for(const i of this.cachedBonusWords){i.text.length!==e&&(e=i.text.length,t.push({text:`${e}-Letter Words:`,found:!0,isHeader:!0}));const n=this.foundBonusWords.has(i.text);t.push({text:n?i.text.toUpperCase():"*".repeat(i.text.length),found:n,isHeader:!1})}return t}buildBonusWordGroups(){if(!this.bonusWordsCacheIsValid){const e=new Map;for(const i of this.allPotentialSolutions)this.isGridSolution(i.text)||e.set(i.text,i);this.cachedBonusWords=Array.from(e.values()).sort((i,n)=>i.text.length!==n.text.length?i.text.length-n.text.length:i.text.localeCompare(n.text)),this.bonusWordsCacheIsValid=!0}const t=new Map;for(const e of this.cachedBonusWords){const i=this.foundBonusWords.has(e.text),n=t.get(e.text.length);n?n.push({text:e.text,found:i}):t.set(e.text.length,[{text:e.text,found:i}])}return Array.from(t.entries()).sort(([e],[i])=>e-i).map(([e,i])=>({length:e,title:`${e}-Letter Words:`,words:i}))}drawMenuPanel(t,e,i){if(i.length===0)return;const n=i[0].rect.x-U,o=i[0].rect.y-U-40,l=ct+U*2,r=U*2+40+i.length*J+(i.length-1)*st;this.images.menuBackground?t.drawImage(this.images.menuBackground,n,o,l,r):k(t,n,o,l,r,12,this.currentTheme.menuBg),et(t,e,{x:n+l/2,y:o+24},this.currentTheme.menuTitleText,this.font(24,!0));for(const h of i){const d=v(h.rect,this.mousePos);this.drawButton(t,h.rect,h.label,d?this.currentTheme.menuButtonHover:this.currentTheme.menuButtonNormal)}}drawButton(t,e,i,n,o=this.currentTheme.menuButtonText){this.images.menuButton?t.drawImage(this.images.menuButton,e.x,e.y,e.width,e.height):k(t,e.x,e.y,e.width,e.height,8,n),et(t,i,{x:e.x+e.width/2,y:e.y+e.height/2},o,this.font(18,!0))}updateLetterAnims(t){this.letterAnims=this.letterAnims.filter(e=>{if(e.t+=t*3,e.t>=1){if(e.t=1,e.target===ot.Grid){const i=this.grid[e.wordIdx];i&&e.charIdx>=0&&e.charIdx<i.length&&(i[e.charIdx]=e.ch,this.checkWordCompletion(e.wordIdx)),this.playSound("place")}return!1}return!0})}updateScoreFlourishes(t){this.scoreFlourishes=this.scoreFlourishes.filter(e=>{if(e.position={x:e.position.x+e.velocity.x*t,y:e.position.y+e.velocity.y*t},e.lifetime-=t,e.lifetime<=0)return!1;const i=Y(e.lifetime/e.initialLifetime,0,1);return e.color={...e.color,a:i*255},!0})}updateHintPointAnims(t){this.hintPointAnims=this.hintPointAnims.filter(e=>{e.t+=t*e.speed;const i=Y(e.t,0,1);return e.currentPosition={x:St(e.startPosition.x,e.targetPosition.x,i),y:St(e.startPosition.y,e.targetPosition.y,i)},e.t<1})}spawnScoreFlourish(t,e){if(t===0)return;const i=this.sorted[e]?.text;if(!i)return;const n=this.tilePos(e,0),o=this.tilePos(e,i.length-1),l=W*this.currentGridLayoutScale*(this.currentGridLayoutScale<1?Bt:1),r={x:(n.x+o.x)/2+l/2,y:n.y-l*.5},h=B(Oe,Ne);this.scoreFlourishes.push({textString:`+${t}`,position:r,velocity:{x:B(-Gt,Gt),y:B(He,be)},lifetime:h,initialLifetime:h,color:{r:255,g:215,b:0,a:255}})}spawnHintPointAnimation(t,e){const i={x:t.x+t.width/2,y:t.y},n={x:t.x+t.width/2,y:t.y-24};this.hintPointAnims.push({textString:`+${e}`,currentPosition:i,startPosition:i,targetPosition:n,color:{r:255,g:255,b:0,a:255},t:0,speed:.8})}activateHint(t){if(this.gameState===$.Solved){this.playSound("error");return}let e=!1;for(let o=0;o<this.grid.length;o+=1)if(!this.found.has(this.sorted[o].text)&&this.grid[o].some(l=>l==="_")){e=!0;break}if(!e){this.playSound("error");return}const i=[];if(t===Z.RevealFirst){for(let o=0;o<this.grid.length;o+=1)if(!this.found.has(this.sorted[o].text)){for(let l=0;l<this.grid[o].length;l+=1)if(this.grid[o][l]==="_"){i.push({wordIdx:o,charIdx:l,letter:this.sorted[o].text[l]});break}if(i.length)break}}else if(t===Z.RevealRandom)for(let o=0;o<this.grid.length;o+=1){if(this.found.has(this.sorted[o].text))continue;const l=this.grid[o].map((r,h)=>r==="_"?h:-1).filter(r=>r>=0);if(l.length>0){const r=l[Math.floor(Math.random()*l.length)];i.push({wordIdx:o,charIdx:r,letter:this.sorted[o].text[r]})}}else if(t===Z.RevealLast){for(let o=this.grid.length-1;o>=0;o-=1)if(!this.found.has(this.sorted[o].text)){for(let l=0;l<this.grid[o].length;l+=1)this.grid[o][l]==="_"&&i.push({wordIdx:o,charIdx:l,letter:this.sorted[o].text[l]});if(i.length)break}}else if(t===Z.RevealFirstOfEach)for(let o=0;o<this.grid.length;o+=1){if(this.found.has(this.sorted[o].text))continue;const l=this.grid[o].findIndex(r=>r==="_");l>=0&&i.push({wordIdx:o,charIdx:l,letter:this.sorted[o].text[l]})}if(i.length===0){this.playSound("error");return}this.playSound("hintUsed");let n=0;for(const o of i){const l=this.tilePos(o.wordIdx,o.charIdx),r=W*this.currentGridLayoutScale*(this.currentGridLayoutScale<1?Bt:1);let h=this.wheelCenter;for(let d=0;d<this.base.length;d+=1)if(this.base[d].toUpperCase()===o.letter.toUpperCase()){h=this.wheelLetterRenderPos[d]??h;break}this.letterAnims.push({ch:o.letter.toUpperCase(),start:h,end:{x:l.x+r/2,y:l.y+r/2},t:n,wordIdx:o.wordIdx,charIdx:o.charIdx,target:ot.Grid}),n-=.03}}checkWordCompletion(t){if(!this.grid[t]||!this.sorted[t])return;const e=this.sorted[t].text;if(this.found.has(e)||this.grid[t].some(n=>n==="_"))return;if(this.grid[t].join("").toUpperCase()===e.toUpperCase()){this.found.add(e);const n=e.length*10,o=this.sorted[t].rarity>1?this.sorted[t].rarity*25:0,l=n+o;this.currentScore+=l,this.spawnScoreFlourish(l,t),this.scoreFlourishTimer=dt,this.found.size===this.solutions.length&&(this.gameState=$.Solved,this.currentScreen=I.GameOver,this.playSound("win"))}}tilePos(t,e){const i=W*this.currentGridLayoutScale,n=z*this.currentGridLayoutScale,o=this.wordCol[t]??0,l=this.wordRow[t]??0,r=(this.colXOffset[o]??this.gridStartX)+e*(i+n),h=this.gridStartY+l*(i+n);return{x:r,y:h}}calculateTotalPossibleBonusWords(){return this.allPotentialSolutions.filter(t=>!this.isGridSolution(t.text)).length}isGridSolution(t){return this.solutions.some(e=>e.text===t)}startCelebrationEffects(){this.celebrationTimer=0,this.confetti=[];for(let t=0;t<100;t+=1)this.confetti.push({position:{x:B(0,b),y:B(0,H)},velocity:{x:B(-30,30),y:B(20,80)},angularVelocity:B(-3,3),lifetime:B(2,4),initialLifetime:B(2,4),rotation:B(0,Math.PI*2),size:{x:B(4,8),y:B(6,12)},color:{r:B(50,255,!0),g:B(50,255,!0),b:B(50,255,!0),a:255}})}updateCelebrationEffects(t){this.currentScreen===I.SessionComplete&&(this.celebrationTimer+=t,this.confetti=this.confetti.filter(e=>(e.position={x:e.position.x+e.velocity.x*t,y:e.position.y+e.velocity.y*t},e.rotation+=e.angularVelocity*t,e.lifetime-=t,e.lifetime>0)))}renderCelebrationEffects(t){for(const e of this.confetti)t.save(),t.translate(e.position.x,e.position.y),t.rotate(e.rotation),t.fillStyle=P(e.color),t.fillRect(-e.size.x/2,-e.size.y/2,e.size.x,e.size.y),t.restore()}clearDragState(){this.dragging=!1,this.path=[],this.currentGuess="",this.wheelTouchScaleActive=!1}getCriteriaForCurrentPuzzle(){const t=this.currentPuzzleIndex===this.puzzlesPerSession-1;return this.selectedDifficulty===C.Easy?{allowedLengths:[7],allowedRarities:[1]}:this.selectedDifficulty===C.Medium?{allowedLengths:[7],allowedRarities:[1,2,3]}:this.selectedDifficulty===C.Hard?{allowedLengths:[7],allowedRarities:t?[4]:[3,4]}:{allowedLengths:[4,5,6,7],allowedRarities:[1,2,3,4]}}getCanonicalLetters(t){return t.toLowerCase().split("").sort().join("")}startBackgroundMusic(){if(!this.hasUserInteracted||this.backgroundMusic||N.music.length===0)return;const t=N.music[Math.floor(Math.random()*N.music.length)],e=new Audio(t);e.loop=!0,e.volume=.4,e.play().catch(()=>{}),this.backgroundMusic=e}playSound(t){const e=this.sounds[t];e&&(e.currentTime=0,e.play().catch(()=>{}))}drawBackground(t){const e=this.images.mainBackground;if(!e)return;const i=Math.max(b/e.width,H/e.height),n=e.width*i,o=e.height*i,l=(b-n)/2,r=(H-o)/2;t.drawImage(e,l,r,n,o)}font(t,e=!1){return`${e?"bold ":""}${t}px ${this.fontFamily}, Arial, sans-serif`}scale(t){return t*this.uiScale*de}}const it=document.getElementById("gameCanvas");if(!it)throw new Error("Missing #gameCanvas element.");const ee=it.getContext("2d");if(!ee)throw new Error("Failed to get 2D context.");const Mt=new Hi(it,ee),ie=()=>{const a=window.devicePixelRatio||1,t=it.getBoundingClientRect();it.width=Math.floor(t.width*a),it.height=Math.floor(t.height*a),Mt.onResize(t.width,t.height,a)};window.addEventListener("resize",ie);ie();let te=performance.now();const se=a=>{const t=Math.min(.1,(a-te)/1e3);te=a,Mt.update(t),Mt.render(),requestAnimationFrame(se)};requestAnimationFrame(se);
