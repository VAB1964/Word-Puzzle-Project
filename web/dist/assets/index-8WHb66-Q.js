(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function e(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=e(n);fetch(n.href,o)}})();const O={menuBackground:new URL(""+new URL("MenuBackground-DLZzkP1L.png",import.meta.url).href,import.meta.url).toString(),menuButton:new URL(""+new URL("MenuButton-DA5PBXzQ.png",import.meta.url).href,import.meta.url).toString(),mainBackground:new URL(""+new URL("BackgroundandFrame-Be8I9v-5.png",import.meta.url).href,import.meta.url).toString(),hintFrame:new URL(""+new URL("HintButtonFrame-B4QjkPso.png",import.meta.url).href,import.meta.url).toString(),hintIndicator:new URL(""+new URL("LightOn_small-DkJS4x_p.png",import.meta.url).href,import.meta.url).toString(),scrambleButton:new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAMAAAD04JH5AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAByUExURfywRtWbSuKlUNKhXd6iTd2hTeOmUeCkT9OZSdGhXN+iTtCXSM2VR9CfW8+eWt+jTuWoU9qeS+KlT+SmUdufTNugTOGkT9ugTc+XR9SaScycV86dWdGYSNKZSdOiXtacS8mYVciYVMeXU8aWU82cWAAAAKj755cAAAAmdFJOU/////////////////////////////////////////////////8Ap3qBvAAAAAlwSFlzAAAOwgAADsIBFShKgAAAABl0RVh0U29mdHdhcmUAUGFpbnQuTkVUIDUuMS4xMYoIFs4AAAC4ZVhJZklJKgAIAAAABQAaAQUAAQAAAEoAAAAbAQUAAQAAAFIAAAAoAQMAAQAAAAIAAAAxAQIAEQAAAFoAAABphwQAAQAAAGwAAAAAAAAA8nYBAOgDAADydgEA6AMAAFBhaW50Lk5FVCA1LjEuMTEAAAMAAJAHAAQAAAAwMjMwAaADAAEAAAABAAAABaAEAAEAAACWAAAAAAAAAAIAAQACAAQAAABSOTgAAgAHAAQAAAAwMTAwAAAAAFztYfoJ6Kq7AAADa0lEQVR4Xu3X6VYUQQyG4QFFFAFBUUEU3Lj/W7Sq+4WuJalOejY41vPH6aSS+s4cHIbVw571AD1AD9AD9AA9QA/wcgOsCpTdlgxyZY2+i3uIuzScsnNOcE0TR408x7lgHufRjuQIwHYTRqLisWQOMOy1Y4o5XkuMAYY1Pung+FpkCzCu8ZoGxy0iSwC2+E2TbBIYArAjR29CXcEhwXwAViRo1OgLOCCYDcCGCXUZZyq0BXMBWPCEso5zJbq1mY2MP6LaxtkcvVp7J9OgOI/zKTq15laGQdGCiQSNWmsts6BowkiKTsUagJINMxlalcZmJgeUbJjJ0avoqxkcULJhpkCzYgpAxYaZCu2SnixByYSRGv2SJQAVE0YEHCip9QkVI4Zq9EtKnaGIigODJbqFbQQImM3QKshlRiIqfsxPqBe2FyBiByjm5gJQWI49EZWcWGUgorIWVi0KQGF96rJdBVBJV3B5QGGbeoBmAJ636jkG4PaAwlb1AM86AM/btaMAB+rG3QQ4ZKN0G/8mOLvJACzsAV5KgMfjPG0CG60BhgFebcZ4e8BzYrMXabh+bwFecf3eArzm+r0F4PbV6ohCYrcBeE79FwGefhXtKwC3BxRSOw3whkJqBwGOuV58A5QAq7fveLUB3B5QyCgBohMe1jUsi4RPAS3Ae0ZOzyisgVUBhZxcPWck+kBtKdYEFHJyNZmKjqkuwYrggkrOFCC4pOF1wXxApaCUp99fiUOaHowGH6kUlAD1WzASf5Ab+IMkolJyBgg4YMNM8IlKyR3gigMmzERUKlrjhLkKfRNGIio1PZmMrgkj0QGlmjMATRNGBpQEvgD0TBgZUJKovSNmU7RMGBm0Ps31pQwnaJgwMqIm8gSQvtDI8v9DFGWeAOb3gNOgqPAFWH2m2XLFWVDV6P3py3TmC23NV849oqxqHGBDpfVhnPzyGVHXLQgQyG+D8PFNp6Fx5Jolsptzjo2+nVJPXdNsaQS4ZU048p1XPqZvcq03iT3xZfLNymzYMWs+AA/Vj9cM65fIVoAfcRGvg2GvFTPzWifvykXjbgPOWzTP1pu4oI2zNr7TwSW3aLx/QLgDBPrP4z0nHJYECM7qEDfL/pBdGGB0d/vz1+8/f2/veF5irQCb0AP0AD1AD9AD9AA9QA+w5wAPD/8ANBrEov9sMIoAAAAASUVORK5CYII=",import.meta.url).toString(),gridButton:new URL(""+new URL("Button-B2CLfsDZ.png",import.meta.url).href,import.meta.url).toString(),circularLetterFrame:new URL(""+new URL("CircularLetterFrame-CkYvd1XA.png",import.meta.url).href,import.meta.url).toString(),sapphire:new URL(""+new URL("emerald-BGbKOI70.png",import.meta.url).href,import.meta.url).toString(),ruby:new URL(""+new URL("ruby-DR_7d093.png",import.meta.url).href,import.meta.url).toString(),diamond:new URL(""+new URL("diamond-CHyP0IXF.png",import.meta.url).href,import.meta.url).toString(),fonts:{arialBold:new URL(""+new URL("arialbd-FEHhJQl7.ttf",import.meta.url).href,import.meta.url).toString()},sounds:{select:new URL(""+new URL("select_letter-sKQaRmsV.wav",import.meta.url).href,import.meta.url).toString(),place:new URL(""+new URL("place_letter-B5tfq3mA.wav",import.meta.url).href,import.meta.url).toString(),win:new URL(""+new URL("puzzle_solved-CNmPFP6L.wav",import.meta.url).href,import.meta.url).toString(),click:new URL(""+new URL("button_click-D3i_P9Ct.wav",import.meta.url).href,import.meta.url).toString(),hintUsed:new URL(""+new URL("button_click-D3i_P9Ct.wav",import.meta.url).href,import.meta.url).toString(),error:new URL(""+new URL("hint_used-CKITXbRV.mp3",import.meta.url).href,import.meta.url).toString()},music:[new URL(""+new URL("track1-D5Cx8o1J.mp3",import.meta.url).href,import.meta.url).toString(),new URL(""+new URL("track2-BllHWJ1v.mp3",import.meta.url).href,import.meta.url).toString(),new URL(""+new URL("track3-BVgx_gWX.mp3",import.meta.url).href,import.meta.url).toString(),new URL(""+new URL("track2-BllHWJ1v.mp3",import.meta.url).href,import.meta.url).toString(),new URL(""+new URL("track5-udI9VZkE.mp3",import.meta.url).href,import.meta.url).toString()],wordsCsv:new URL(""+new URL("words_processed-XaCKYsME.csv",import.meta.url).href,import.meta.url).toString()},N=1e3,H=800,ae=40,ue=20,W=40,z=5,ut=10,Nt=4,ce=5,de=.75,Bt=.95,fe=80,ge=125,me=80,pe=40,ct=3,Se=4,Te=7,Ae=12,xe=15,Ht=5,ye=2,we=3,Be=5,_e=7,Ie=10,Le=120,Ft=35,Re=20,dt=250,J=75,U=70,st=10,Ee=0,Gt=0,Pe=5,Me=7,Ce=10,ve=20,be=1.8,Oe=2.8,Ne=-50,He=-90,Wt=20,ft=.4,Fe=1.3,_t=300,It=180,Ge=40,We=7,Ue=420,De=50,ze=6,ke=12,Xe=5,gt=50,Ve=10,Ye=8,Ze=6,Qe=5,qe=22,je=26,Je=.7,Ke=1.35,$e=10,Ut=3,ti=.95,ei=.95,ii=35,si=20,nt={x:90,y:122,width:815,height:273},Dt={x:110,y:475,width:245,height:245},mt={x:374,y:450,width:285,height:285},ni={x:660,y:500,width:243,height:195},Lt={x:50,y:10,height:30},zt=2,kt=2,pt=10,oi=3,ri=15,St=18,li=.08,hi=.2,ai=16,Rt=1.8,ot=1.4,Xt=68,ui=26,ci=25,Vt=18,Yt=28;var rt=(h=>(h.Grid="Grid",h.Score="Score",h))(rt||{}),$=(h=>(h.Playing="Playing",h.Solved="Solved",h))($||{}),L=(h=>(h.MainMenu="MainMenu",h.CasualMenu="CasualMenu",h.CompetitiveMenu="CompetitiveMenu",h.Playing="Playing",h.GameOver="GameOver",h.SessionComplete="SessionComplete",h))(L||{}),C=(h=>(h.None="None",h.Easy="Easy",h.Medium="Medium",h.Hard="Hard",h))(C||{}),Z=(h=>(h.RevealFirst="RevealFirst",h.RevealRandom="RevealRandom",h.RevealLast="RevealLast",h.RevealFirstOfEach="RevealFirstOfEach",h))(Z||{});const s=(h,t,e,i=255)=>({r:h,g:t,b:e,a:i}),Zt=()=>{const h=[],t={winBg:s(30,37,51),decorBase:s(45,52,67),decorAccent1:s(208,232,242),decorAccent2:s(155,211,255),gridEmptyTile:s(100,110,120,180),gridFilledTile:s(155,211,255),gridLetter:s(255,190,70),wheelBg:s(45,52,67,150),wheelOutline:s(155,211,255),letterCircleNormal:s(240,240,240,220),letterCircleHighlight:s(34,161,57,230),letterTextNormal:s(30,37,51),letterTextHighlight:s(255,255,255),dragLine:s(0,105,255,200),continueButton:s(100,200,100),hudTextGuess:s(155,211,255),hudTextFound:s(255,100,0),hudTextSolved:s(155,211,255),solvedOverlayBg:s(40,50,70,210),scoreBarBg:s(45,52,67,230),scoreTextLabel:s(255,190,70),scoreTextValue:s(255,190,70),menuBg:s(40,50,70,210),menuTitleText:s(208,232,242),menuButtonNormal:s(80,90,110),menuButtonHover:s(120,135,150),menuButtonText:s(255,255,255)};h.push(t);const e={winBg:s(46,34,53),decorBase:s(69,48,78),decorAccent1:s(236,150,127),decorAccent2:s(255,199,138),gridEmptyTile:s(100,80,90,180),gridFilledTile:s(217,95,67),gridLetter:s(255,255,255),wheelBg:s(69,48,78,150),wheelOutline:s(236,150,127),letterCircleNormal:s(255,255,255,220),letterCircleHighlight:s(217,95,67,230),letterTextNormal:s(46,34,53),letterTextHighlight:s(255,255,255),dragLine:s(247,156,41,200),continueButton:s(217,95,67),hudTextGuess:s(255,199,138),hudTextFound:s(255,199,138),hudTextSolved:s(247,156,41),solvedOverlayBg:s(69,48,78,220),scoreBarBg:s(69,48,78,230),scoreTextLabel:s(255,190,70),scoreTextValue:s(255,190,70),menuBg:s(69,48,78,210),menuTitleText:s(236,150,127),menuButtonNormal:s(100,80,90),menuButtonHover:s(130,110,120),menuButtonText:s(255,255,255)};h.push(e);const i={winBg:s(61,44,33),decorBase:s(94,68,54),decorAccent1:s(245,235,220),decorAccent2:s(218,145,70),gridEmptyTile:s(188,169,147,180),gridFilledTile:s(218,145,70),gridLetter:s(245,235,220),wheelBg:s(138,104,73,150),wheelOutline:s(245,235,220),letterCircleNormal:s(245,235,220,220),letterCircleHighlight:s(218,145,70,230),letterTextNormal:s(61,44,33),letterTextHighlight:s(61,44,33),dragLine:s(245,235,220,200),continueButton:s(218,145,70),hudTextGuess:s(245,235,220),hudTextFound:s(245,235,220),hudTextSolved:s(245,235,220),solvedOverlayBg:s(94,68,54,210),scoreBarBg:s(94,68,54,230),scoreTextLabel:s(255,190,70),scoreTextValue:s(255,190,70),menuBg:s(94,68,54,210),menuTitleText:s(245,235,220),menuButtonNormal:s(138,104,73),menuButtonHover:s(168,148,121),menuButtonText:s(245,235,220)};h.push(i);const n={winBg:s(25,20,35),decorBase:s(40,35,50),decorAccent1:s(0,255,255),decorAccent2:s(255,0,255),gridEmptyTile:s(60,60,70,180),gridFilledTile:s(255,0,255),gridLetter:s(255,255,255),wheelBg:s(50,50,60,150),wheelOutline:s(0,255,255),letterCircleNormal:s(70,60,80,220),letterCircleHighlight:s(0,255,255,230),letterTextNormal:s(255,255,0),letterTextHighlight:s(25,20,35),dragLine:s(255,255,0,200),continueButton:s(255,0,255),hudTextGuess:s(0,255,255),hudTextFound:s(0,255,255),hudTextSolved:s(255,255,0),solvedOverlayBg:s(40,35,50,220),scoreBarBg:s(40,35,50,230),scoreTextLabel:s(255,190,70),scoreTextValue:s(255,190,70),menuBg:s(40,35,50,210),menuTitleText:s(0,255,255),menuButtonNormal:s(70,60,80),menuButtonHover:s(100,90,110),menuButtonText:s(255,255,0)};h.push(n);const o={winBg:s(40,40,40),decorBase:s(70,70,70),decorAccent1:s(150,150,150),decorAccent2:s(220,220,220),gridEmptyTile:s(100,100,100,180),gridFilledTile:s(180,180,180),gridLetter:s(255,255,255),wheelBg:s(60,60,60,150),wheelOutline:s(180,180,180),letterCircleNormal:s(190,190,190,220),letterCircleHighlight:s(100,150,200,230),letterTextNormal:s(0,0,0),letterTextHighlight:s(255,255,255),dragLine:s(100,150,200,200),continueButton:s(100,150,200),hudTextGuess:s(255,255,255),hudTextFound:s(255,255,255),hudTextSolved:s(100,150,200),solvedOverlayBg:s(70,70,70,210),scoreBarBg:s(70,70,70,230),scoreTextLabel:s(255,190,70),scoreTextValue:s(255,190,70),menuBg:s(70,70,70,210),menuTitleText:s(220,220,220),menuButtonNormal:s(100,100,100),menuButtonHover:s(130,130,130),menuButtonText:s(255,255,255)};h.push(o);const r={winBg:s(105,184,110),decorBase:s(245,247,22),decorAccent1:s(255,190,200,230),decorAccent2:s(255,255,200),gridEmptyTile:s(190,205,195,180),gridFilledTile:s(90,170,100),gridLetter:s(190,205,195),wheelBg:s(180,220,190,150),wheelOutline:s(110,160,120),letterCircleNormal:s(240,255,245,220),letterCircleHighlight:s(255,190,200,230),letterTextNormal:s(40,70,45),letterTextHighlight:s(40,70,45),dragLine:s(80,180,90,200),continueButton:s(90,170,100),hudTextGuess:s(50,100,55),hudTextFound:s(50,100,55),hudTextSolved:s(0,180,0),solvedOverlayBg:s(180,220,190,210),scoreBarBg:s(170,210,180,230),scoreTextLabel:s(255,190,70),scoreTextValue:s(255,190,70),menuBg:s(180,220,190,220),menuTitleText:s(40,70,45),menuButtonNormal:s(140,190,150),menuButtonHover:s(110,160,120),menuButtonText:s(40,70,45)};h.push(r);const l={winBg:s(15,25,45),decorBase:s(20,35,60),decorAccent1:s(35,55,85),decorAccent2:s(0,130,140),gridEmptyTile:s(50,60,80,180),gridFilledTile:s(0,180,170),gridLetter:s(210,245,255),wheelBg:s(40,60,90,150),wheelOutline:s(80,120,180),letterCircleNormal:s(190,210,225,220),letterCircleHighlight:s(0,180,170,230),letterTextNormal:s(15,25,45),letterTextHighlight:s(15,25,45),dragLine:s(0,200,190,200),continueButton:s(0,150,130),hudTextGuess:s(180,230,240),hudTextFound:s(180,230,240),hudTextSolved:s(50,220,210),solvedOverlayBg:s(25,40,65,210),scoreBarBg:s(35,55,85,230),scoreTextLabel:s(255,190,70),scoreTextValue:s(255,190,70),menuBg:s(25,40,65,220),menuTitleText:s(210,245,255),menuButtonNormal:s(50,80,120),menuButtonHover:s(80,120,180),menuButtonText:s(210,245,255)};h.push(l);const a={winBg:s(78,156,199),decorBase:s(225,225,215),decorAccent1:s(205,205,195),decorAccent2:s(185,185,175),gridEmptyTile:s(154,199,198,180),gridFilledTile:s(255,255,255),gridLetter:s(0,0,0),wheelBg:s(215,215,205,150),wheelOutline:s(140,140,130),letterCircleNormal:s(255,255,255,220),letterCircleHighlight:s(190,210,240,230),letterTextNormal:s(0,0,0),letterTextHighlight:s(0,0,0),dragLine:s(80,80,80,200),continueButton:s(90,90,90),hudTextGuess:s(181,179,152),hudTextFound:s(40,40,40),hudTextSolved:s(0,100,0),solvedOverlayBg:s(215,215,205,210),scoreBarBg:s(205,205,195,230),scoreTextLabel:s(255,190,70),scoreTextValue:s(255,190,70),menuBg:s(215,215,205,220),menuTitleText:s(20,20,20),menuButtonNormal:s(170,170,160),menuButtonHover:s(140,140,130),menuButtonText:s(20,20,20)};h.push(a);const d={winBg:s(55,30,15),decorBase:s(85,50,25),decorAccent1:s(125,70,35),decorAccent2:s(190,80,30),gridEmptyTile:s(100,70,45,180),gridFilledTile:s(200,100,30),gridLetter:s(255,245,210),wheelBg:s(75,45,20,150),wheelOutline:s(140,90,50),letterCircleNormal:s(240,230,200,220),letterCircleHighlight:s(230,130,40,230),letterTextNormal:s(55,30,15),letterTextHighlight:s(55,30,15),dragLine:s(230,130,40,200),continueButton:s(180,90,25),hudTextGuess:s(255,225,180),hudTextFound:s(255,225,180),hudTextSolved:s(255,150,0),solvedOverlayBg:s(85,50,25,210),scoreBarBg:s(85,50,25,230),scoreTextLabel:s(255,190,70),scoreTextValue:s(255,190,70),menuBg:s(85,50,25,220),menuTitleText:s(255,245,210),menuButtonNormal:s(125,70,35),menuButtonHover:s(155,90,45),menuButtonText:s(255,245,210)};return h.push(d),h},di=Math.PI,Qt=h=>h*di/180,Et=(h,t)=>{const e=h.x-t.x,i=h.y-t.y;return e*e+i*i},Y=(h,t,e)=>Math.max(t,Math.min(e,h)),Tt=(h,t,e)=>h+(t-h)*e,w=(h,t,e=!1)=>{const i=Math.random()*(t-h)+h;return e?Math.floor(i):i},Pt=h=>{for(let t=h.length-1;t>0;t-=1){const e=Math.floor(Math.random()*(t+1));[h[t],h[e]]=[h[e],h[t]]}return h},v=(h,t)=>t.x>=h.x&&t.x<=h.x+h.width&&t.y>=h.y&&t.y<=h.y+h.height,P=h=>{const t=h.a??255,e=Math.max(0,Math.min(1,t/255));return`rgba(${h.r}, ${h.g}, ${h.b}, ${e})`},G=h=>h.trim(),fi=h=>{const t=[];let e="",i=!1;for(let n=0;n<h.length;n+=1){const o=h[n];o==='"'?i&&n+1<h.length&&h[n+1]==='"'?(e+='"',n+=1):i=!i:o===","&&!i?(t.push(e),e=""):e+=o}return t.push(e),t},gi=h=>{const t=h.split(/\r?\n/),e=[];let i="",n=!1;for(const o of t){i&&(i+=`
`),i+=o;for(let r=0;r<o.length;r+=1)o[r]==='"'&&(n&&r+1<o.length&&o[r+1]==='"'?r+=1:n=!n);n||(e.push(i),i="")}return i&&e.push(i),e},mi=()=>({text:"",rarity:0,pos:"",definition:"",sentence:"",avgSubLen:0,countGE3:0,countGE4:0,countGE5:0,easyValidCount:0,mediumValidCount:0,hardValidCount:0}),pi=async h=>{const t=await fetch(h);if(!t.ok)throw new Error(`Failed to load word list: ${t.status} ${t.statusText}`);const e=await t.text(),i=gi(e);if(i.length<=1)return[];const n=[];for(let o=1;o<i.length;o+=1){const r=i[o];if(r.trim())try{const l=fi(r),a=mi();l.length>0&&(a.text=G(l[0]).toLowerCase()),l.length>1&&(a.rarity=parseInt(G(l[1])||"0",10)),l.length>2&&(a.pos=G(l[2])),l.length>3&&(a.definition=G(l[3])),l.length>4&&(a.sentence=G(l[4])),l.length>5&&(a.avgSubLen=parseFloat(G(l[5])||"0")),l.length>6&&(a.countGE3=parseInt(G(l[6])||"0",10)),l.length>7&&(a.countGE4=parseInt(G(l[7])||"0",10)),l.length>8&&(a.countGE5=parseInt(G(l[8])||"0",10)),l.length>9&&(a.easyValidCount=parseInt(G(l[9])||"0",10)),l.length>10&&(a.mediumValidCount=parseInt(G(l[10])||"0",10)),l.length>11&&(a.hardValidCount=parseInt(G(l[11])||"0",10)),a.text&&n.push(a)}catch(l){console.warn("Skipping malformed word record",l)}}return n},Si=(h,t)=>h.filter(e=>e.text.length===t),Ti=(h,t)=>{if(!h)return[];const e=h.toLowerCase(),i=new Map;for(const o of e)i.set(o,(i.get(o)??0)+1);const n=[];for(const o of t){const r=o.text.toLowerCase();if(!r||r.length>e.length||r===e)continue;const l=new Map;let a=!0;for(const d of r)if(l.set(d,(l.get(d)??0)+1),(i.get(d)??0)<(l.get(d)??0)){a=!1;break}a&&n.push(o)}return n},Ai=h=>[...h].sort((t,e)=>t.text.length!==e.text.length?t.text.length-e.text.length:t.text.localeCompare(e.text,void 0,{sensitivity:"base"}));class xi{constructor(t=25){this.targetCount=t}shapes=[];update(t,e,i){for(;this.shapes.length<this.targetCount;)this.spawn(e,i.decorBase,i.decorAccent1,i.decorAccent2);for(const n of this.shapes)n.pos={x:n.pos.x+n.vel.x*t,y:n.pos.y+n.vel.y*t},n.vel.x>0&&n.pos.x-n.size>e.x?(n.pos.x=-n.size-w(50,150),n.pos.y=w(0,e.y)):n.vel.x<0&&n.pos.x+n.size<0&&(n.pos.x=e.x+n.size+w(50,150),n.pos.y=w(0,e.y)),n.pos.y-n.size>e.y?n.pos.y=-n.size:n.pos.y+n.size<0&&(n.pos.y=e.y+n.size)}draw(t){for(const e of this.shapes){if(t.save(),t.fillStyle=P(e.color),e.kind==="Circle")t.beginPath(),t.arc(e.pos.x,e.pos.y,e.size,0,Math.PI*2),t.fill();else if(e.kind==="Triangle"){const i=[];for(let n=0;n<3;n+=1){const o=Qt(e.rot+n*120);i.push({x:e.pos.x+Math.cos(o)*e.size,y:e.pos.y+Math.sin(o)*e.size})}t.beginPath(),t.moveTo(i[0].x,i[0].y),t.lineTo(i[1].x,i[1].y),t.lineTo(i[2].x,i[2].y),t.closePath(),t.fill()}else e.kind==="Line"&&(t.translate(e.pos.x,e.pos.y),t.rotate(Qt(e.rot)),t.fillRect(-e.size/2,-1,e.size,2));t.restore()}}spawn(t,e,i,n){const o=w(0,1,!0)===0,r=w(0,2,!0),l=["Circle","Triangle","Line"][r]??"Circle",a=w(0,t.y),d=o?-w(50,200):t.x+w(50,200),c={kind:l,pos:{x:d,y:a},vel:{x:(o?1:-1)*w(15,45),y:0},size:0,rot:w(0,360),color:e};l==="Circle"?(c.size=w(50,120),c.color={...e,a:w(60,100,!0)}):l==="Triangle"?(c.size=w(40,150),c.color={...i,a:w(30,60,!0)}):(c.size=w(80,180),c.color={...n,a:w(80,140,!0)}),this.shapes.push(c)}}const k=(h,t,e,i,n,o,r,l,a=1)=>{const d=Math.min(o,i/2,n/2);h.beginPath(),h.moveTo(t+d,e),h.arcTo(t+i,e,t+i,e+n,d),h.arcTo(t+i,e+n,t,e+n,d),h.arcTo(t,e+n,t,e,d),h.arcTo(t,e,t+i,e,d),h.closePath(),r&&(h.fillStyle=P(r),h.fill()),l&&(h.strokeStyle=P(l),h.lineWidth=a,h.stroke())},et=(h,t,e,i,n)=>{h.save(),h.font=n,h.fillStyle=P(i),h.textAlign="center",h.textBaseline="middle",h.fillText(t,e.x,e.y),h.restore()},yi=(h,t,e)=>{if(e<=0)return t;const i=t.split(/\s+/).filter(Boolean);let n="";const o=[],r=()=>{n&&(o.push(n),n="")};for(const l of i){const a=n?`${n} ${l}`:l;if(h.measureText(a).width>e&&n)r(),n=l;else if(h.measureText(a).width>e&&!n){let d="";for(const c of l){const u=d+c;h.measureText(u).width>e&&d&&(o.push(d),d=""),d+=c}d&&o.push(d)}else n=a}return r(),o.join(`
`)},qt=(h,t,e)=>e<=0?t:t.split(/\r?\n/).map(n=>yi(h,n,e)).join(`
`),jt=(h,t,e,i)=>{const n=Math.min(h/e,t/i),o=e*n,r=i*n,l={x:(h-o)/2,y:(t-r)/2};return{scale:n,offset:l,designSize:{x:e,y:i},screenSize:{x:h,y:t},viewport:{x:l.x,y:l.y,width:o,height:r}}},wi=(h,t,e=1)=>{h.setTransform(t.scale*e,0,0,t.scale*e,t.offset.x*e,t.offset.y*e)},Bi=(h,t)=>({x:(t.x-h.offset.x)/h.scale,y:(t.y-h.offset.y)/h.scale}),Jt=["Letter","Random","Full Word","1st of Each"],_i=75,Ii=.33,Li=.5,Ri=.15,Ei=.46,Pi=.55,Mi=2,Kt=20,Ci=4,vi=5,Mt=20,$t=5,bi=5,At=[ye,we,Be,_e],Oi=[Z.RevealFirst,Z.RevealRandom,Z.RevealLast,Z.RevealFirstOfEach],Ni=["This hint will reveal the next available letter.","This hint will reveal one random letter for each word.","This hint will reveal the last word that hasn't been revealed.","This hint will reveal the first unrevealed letter for every word."],X={r:255,g:190,b:70,a:255},K={r:255,g:255,b:255,a:255};class Hi{constructor(t,e){this.canvas=t,this.ctx=e,this.attachInput(),this.init().catch(i=>{this.loadingError=i instanceof Error?i.message:"Failed to initialize game."})}width=0;height=0;view=jt(1,1,N,H);uiScale=1;fontFamily="WordPuzzleFont";dpr=1;ready=!1;loadingError=null;hasUserInteracted=!1;images={};sounds={};backgroundMusic=null;themes=[];currentTheme=Zt()[0];decor=new xi(10);currentScreen=L.MainMenu;gameState=$.Playing;mousePos={x:0,y:0};fullWordList=[];roots=[];base="";solutions=[];sorted=[];grid=[];allPotentialSolutions=[];found=new Set;foundBonusWords=new Set;usedBaseWordsThisSession=new Set;usedLetterSetsThisSession=new Set;hintPoints=0;hintsAvailable=0;wordsSolvedSinceHint=0;currentScore=0;puzzlesPerSession=0;currentPuzzleIndex=0;isInSession=!1;selectedDifficulty=C.None;bonusWordsPopupScrollOffset=0;bonusWordsPopupMaxScrollOffset=0;cachedBonusWords=[];bonusWordsCacheIsValid=!1;bonusTextFlourishTimer=0;hintFrameClickAnimTimers=[0,0,0,0];hintClickableRegions=[];hoveredHintIndex=-1;isHoveringHintPointsText=!1;hoveredSolvedWordIndex=-1;dragging=!1;path=[];currentGuess="";letterPositionRadius=0;visualBgRadius=0;wheelLetterRenderPos=[];currentWheelRadius=0;currentLetterRenderRadius=0;wheelCenter={x:0,y:0};wheelTouchScaleActive=!1;gridStartX=0;gridStartY=0;currentGridLayoutScale=1;wordCol=[];wordRow=[];colMaxLen=[];colXOffset=[];scoreFlourishes=[];hintPointAnims=[];scoreFlourishTimer=0;gridFlourishes=[];letterAnims=[];confetti=[];balloons=[];celebrationTimer=0;mainMenuButtons=[];casualMenuButtons=[];returnToMenuButton={x:0,y:0,width:0,height:0};continueButton={x:0,y:0,width:0,height:0};scrambleButton={x:0,y:0,width:0,height:0};bonusWordsTextRect={x:0,y:0,width:0,height:0};onResize(t,e,i=1){this.width=t,this.height=e,this.dpr=i,this.view=jt(t,e,N,H),this.uiScale=Y(Math.min(t/N,e/H),.65,1.6),this.updateLayout()}update(t){if(this.ready){this.decor.update(t,{x:N,y:H},this.currentTheme),this.scoreFlourishTimer>0&&(this.scoreFlourishTimer=Math.max(0,this.scoreFlourishTimer-t)),this.bonusTextFlourishTimer>0&&(this.bonusTextFlourishTimer=Math.max(0,this.bonusTextFlourishTimer-t)),this.gridFlourishes=this.gridFlourishes.filter(e=>(e.timer-=t,e.timer>0));for(let e=0;e<this.hintFrameClickAnimTimers.length;e+=1)this.hintFrameClickAnimTimers[e]>0&&(this.hintFrameClickAnimTimers[e]=Math.max(0,this.hintFrameClickAnimTimers[e]-t));if(this.updateLetterAnims(t),this.updateScoreFlourishes(t),this.updateHintPointAnims(t),this.updateCelebrationEffects(t),this.currentScreen===L.Playing||this.currentScreen===L.GameOver){this.hoveredHintIndex=-1;for(let e=0;e<this.hintClickableRegions.length;e+=1)if(v(this.hintClickableRegions[e],this.mousePos)){this.hoveredHintIndex=e;break}if(this.isHoveringHintPointsText=v(this.bonusWordsTextRect,this.mousePos),this.hoveredSolvedWordIndex=-1,this.sorted.length>0&&this.grid.length>0&&this.found.size>0){const e=W*this.currentGridLayoutScale;for(let i=0;i<this.sorted.length&&i<this.grid.length;i+=1)if(this.found.has(this.sorted[i].text)){for(let n=0;n<this.sorted[i].text.length&&n<this.grid[i].length;n+=1){const o=this.tilePos(i,n),r={x:o.x,y:o.y,width:e,height:e};if(v(r,this.mousePos)){this.hoveredSolvedWordIndex=i;break}}if(this.hoveredSolvedWordIndex!==-1)break}}}else this.hoveredHintIndex=-1,this.isHoveringHintPointsText=!1,this.bonusWordsPopupScrollOffset=0,this.hoveredSolvedWordIndex=-1}}render(){const t=this.ctx;if(t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,this.canvas.width,this.canvas.height),t.setTransform(this.dpr,0,0,this.dpr,0,0),t.fillStyle="#000",t.fillRect(0,0,this.width,this.height),this.loadingError){t.fillStyle="#fff",t.font="18px sans-serif",t.fillText(this.loadingError,20,30);return}if(!this.ready){t.fillStyle="#fff",t.font="18px sans-serif",t.fillText("Loading...",20,30);return}wi(t,this.view,this.dpr),t.fillStyle=P(this.currentTheme.winBg),t.fillRect(0,0,N,H),this.drawBackground(t),this.currentScreen===L.MainMenu?this.renderMainMenu(t):this.currentScreen===L.CasualMenu?this.renderCasualMenu(t):this.currentScreen===L.SessionComplete?this.renderSessionComplete(t):this.renderGameScreen(t),this.isHoveringHintPointsText&&(this.currentScreen===L.Playing||this.currentScreen===L.GameOver)&&this.renderBonusWordsPopup(t)}async init(){this.themes=Zt(),this.currentTheme=this.themes[0]??this.currentTheme,await Promise.all([this.loadFont(),this.loadImages(),this.loadSounds(),this.loadWords()]),this.ready=!0,this.updateLayout()}async loadFont(){const t=new FontFace(this.fontFamily,`url(${O.fonts.arialBold})`);await t.load(),document.fonts.add(t)}async loadImages(){const t={menuBackground:O.menuBackground,menuButton:O.menuButton,mainBackground:O.mainBackground,hintFrame:O.hintFrame,hintIndicator:O.hintIndicator,scrambleButton:O.scrambleButton,gridButton:O.gridButton,circularLetterFrame:O.circularLetterFrame,sapphire:O.sapphire,ruby:O.ruby,diamond:O.diamond},e=Object.entries(t);await Promise.all(e.map(async([i,n])=>{this.images[i]=await this.loadImage(n)}))}async loadSounds(){const t=Object.entries(O.sounds);for(const[e,i]of t){const n=new Audio(i);n.preload="auto",this.sounds[e]=n}}async loadWords(){this.fullWordList=await pi(O.wordsCsv),this.roots=[];const t=[4,5,6,7];for(const e of t)this.roots.push(...Si(this.fullWordList,e))}async loadImage(t){const e=new Image;return e.src=t,await e.decode().catch(()=>new Promise((i,n)=>{e.onload=()=>i(),e.onerror=()=>n(new Error(`Failed to load image ${t}`))})),e}attachInput(){const t=o=>{this.hasUserInteracted=!0;const r=this.eventToWorld(o);this.mousePos=r,this.canvas.setPointerCapture(o.pointerId),this.handlePointerDown(r,o.pointerType)},e=o=>{const r=this.eventToWorld(o);this.mousePos=r,this.handlePointerMove(r,o.pointerType)},i=o=>{const r=this.eventToWorld(o);this.mousePos=r,this.canvas.releasePointerCapture(o.pointerId),this.handlePointerUp(r,o.pointerType)},n=o=>{this.isHoveringHintPointsText&&(this.bonusWordsPopupScrollOffset=Y(this.bonusWordsPopupScrollOffset+Math.sign(o.deltaY)*ii,0,this.bonusWordsPopupMaxScrollOffset),o.preventDefault())};this.canvas.addEventListener("pointerdown",t),this.canvas.addEventListener("pointermove",e),this.canvas.addEventListener("pointerup",i),this.canvas.addEventListener("wheel",n,{passive:!1})}eventToWorld(t){const e=this.canvas.getBoundingClientRect(),i=t.clientX-e.left,n=t.clientY-e.top;return Bi(this.view,{x:i,y:n})}handlePointerDown(t,e){if(!this.ready)return;if(this.updateWheelTouchScale(t,e),this.currentScreen===L.MainMenu){this.handleMainMenuInput(t);return}if(this.currentScreen===L.CasualMenu){this.handleCasualMenuInput(t);return}if(this.currentScreen===L.SessionComplete){v(this.continueButton,t)&&(this.playSound("click"),this.confetti=[],this.balloons=[],this.currentScreen=L.MainMenu,this.isInSession=!1,this.selectedDifficulty=C.None);return}if(this.currentScreen===L.GameOver){v(this.continueButton,t)&&this.handleContinue();return}if(v(this.returnToMenuButton,t)){this.playSound("click"),this.currentScreen=L.MainMenu,this.isInSession=!1,this.selectedDifficulty=C.None,this.clearDragState();return}if(v(this.scrambleButton,t)){this.playSound("click"),this.base=Pt(this.base.split("")).join(""),this.updateLayout(),this.clearDragState();return}for(let r=0;r<this.hintClickableRegions.length;r+=1)if(v(this.hintClickableRegions[r],t)){this.hintFrameClickAnimTimers[r]=.15,this.hintPoints>=At[r]?(this.hintPoints-=At[r],this.activateHint(Oi[r])):this.playSound("error");return}const i=e==="touch"&&this.wheelTouchScaleActive?ot:1,n=this.currentLetterRenderRadius*i,o=n*n;for(let r=0;r<this.base.length;r+=1){const l=this.getWheelLetterPosition(r);if(l&&Et(t,l)<o){this.dragging=!0,this.path=[r],this.currentGuess=this.base[r].toUpperCase(),this.playSound("select");return}}}handlePointerMove(t,e){if(this.updateWheelTouchScale(t,e),!this.dragging)return;const i=e==="touch"&&this.wheelTouchScaleActive?ot:1,n=this.currentLetterRenderRadius*i,o=n*n;for(let r=0;r<this.base.length;r+=1){const l=this.getWheelLetterPosition(r,i);if(l&&Et(t,l)<o){const a=r;this.path.indexOf(a)===-1?(this.path.push(a),this.currentGuess+=this.base[r].toUpperCase(),this.playSound("select")):this.path.length>=2&&this.path[this.path.length-2]===a&&(this.path.pop(),this.currentGuess=this.currentGuess.slice(0,-1));break}}}handlePointerUp(t,e){if(this.wheelTouchScaleActive=!1,!this.dragging)return;if(this.currentGuess.length<3){this.clearDragState();return}let n=!1;for(let o=0;o<this.sorted.length;o+=1){const r=this.sorted[o].text.toUpperCase();if(r===this.currentGuess){if(this.found.has(this.sorted[o].text)){for(let l=0;l<r.length;l+=1)this.gridFlourishes.push({wordIdx:o,charIdx:l,timer:.6});this.playSound("place"),n=!0}else{this.found.add(this.sorted[o].text);const l=this.currentGuess.length*10,a=this.sorted[o].rarity>1?this.sorted[o].rarity*25:0,d=l+a;this.currentScore+=d,this.spawnScoreFlourish(d,o),this.scoreFlourishTimer=ft;for(let c=0;c<this.currentGuess.length;c+=1)if(c<this.path.length){const u=this.path[c],g=this.wheelLetterRenderPos[u],m=this.tilePos(o,c),S=W*this.currentGridLayoutScale*(this.currentGridLayoutScale<1?Bt:1);this.letterAnims.push({ch:this.currentGuess[c],start:g,end:{x:m.x+S/2,y:m.y+S/2},t:0-c*.03,wordIdx:o,charIdx:c,target:rt.Grid})}this.found.size===this.solutions.length&&(this.gameState=$.Solved,this.currentScreen=L.GameOver),n=!0}break}}if(!n){for(const o of this.allPotentialSolutions)if(o.text.toUpperCase()===this.currentGuess){if(this.foundBonusWords.has(o.text))this.bonusTextFlourishTimer=.6,this.playSound("place");else{this.foundBonusWords.add(o.text);const r=o.text.length;let l=0;r===3?l=1:r===4?l=2:r===5?l=3:r>=6&&(l=4),l>0&&(this.hintPoints+=l,this.spawnHintPointAnimation(this.bonusWordsTextRect,l)),this.playSound("place")}n=!0;break}}n||this.playSound("error"),this.clearDragState()}getWheelLetterPosition(t,e=1){const i=this.wheelLetterRenderPos[t];if(!i||e===1)return i;const n=i.x-this.wheelCenter.x,o=i.y-this.wheelCenter.y;return{x:this.wheelCenter.x+n*e,y:this.wheelCenter.y+o*e}}getWheelTouchRadius(t=1){const e=this.letterPositionRadius*t,i=this.currentLetterRenderRadius*Rt*t;return e+i}updateWheelTouchScale(t,e){if(!this.ready||!this.base||this.base.length===0){this.wheelTouchScaleActive=!1;return}if(e!=="touch"){this.wheelTouchScaleActive=!1;return}if(this.currentScreen!==L.Playing&&this.currentScreen!==L.GameOver){this.wheelTouchScaleActive=!1;return}if(this.wheelTouchScaleActive)return;const i=this.getWheelTouchRadius(1);this.wheelTouchScaleActive=Et(t,this.wheelCenter)<=i*i}handleMainMenuInput(t){if(!(this.mainMenuButtons.length<3)){if(v(this.mainMenuButtons[0],t)){this.playSound("click"),this.currentScreen=L.CasualMenu;return}v(this.mainMenuButtons[2],t)&&(this.playSound("click"),this.currentScreen=L.MainMenu)}}handleCasualMenuInput(t){if(this.casualMenuButtons.length<4)return;const[e,i,n,o]=this.casualMenuButtons;if(v(o,t)){this.playSound("click"),this.currentScreen=L.MainMenu;return}let r=C.None,l=0;v(e,t)?(r=C.Easy,l=Pe):v(i,t)?(r=C.Medium,l=Me):v(n,t)&&(r=C.Hard,l=Ce),r!==C.None&&(this.playSound("click"),this.selectedDifficulty=r,this.puzzlesPerSession=l,this.currentPuzzleIndex=0,this.isInSession=!0,this.usedBaseWordsThisSession.clear(),this.usedLetterSetsThisSession.clear(),this.rebuild(),this.currentScreen=L.Playing)}handleContinue(){this.isInSession?this.currentPuzzleIndex+1<this.puzzlesPerSession?(this.currentPuzzleIndex+=1,this.rebuild(),this.currentScreen=L.Playing):(this.currentScreen=L.SessionComplete,this.startCelebrationEffects()):this.currentScreen=L.MainMenu}rebuild(){this.themes.length>0&&(this.currentTheme=this.themes[Math.floor(Math.random()*this.themes.length)]);const t=this.getCriteriaForCurrentPuzzle();let e=0,i=ct;switch(this.selectedDifficulty){case C.Easy:e=Te,i=ct;break;case C.Medium:e=Ae,i=ct;break;case C.Hard:e=xe,i=Se;break;default:e=999,i=ct;break}let n="",o="",r=!1;const l=Pt([...this.roots]),a=[],d=[],c=[];for(let m=0;m<l.length;m+=1){const S=l[m];if(!t.allowedLengths.includes(S.text.length)||!t.allowedRarities.includes(S.rarity)||this.usedBaseWordsThisSession.has(S.text))continue;const y=this.getCanonicalLetters(S.text);if(this.usedLetterSetsThisSession.has(y))continue;let B=S.countGE4;this.selectedDifficulty===C.Easy&&(B=S.easyValidCount),this.selectedDifficulty===C.Medium&&(B=S.mediumValidCount),this.selectedDifficulty===C.Hard&&(B=S.hardValidCount),B>=Ht?a.push(m):d.push(m)}const u=m=>m[Math.floor(Math.random()*m.length)];if(a.length>0)n=l[u(a)].text,r=!0;else if(d.length>0)n=l[u(d)].text,r=!0;else{for(let m=0;m<l.length;m+=1){const S=l[m];if(this.usedBaseWordsThisSession.has(S.text))continue;const y=this.getCanonicalLetters(S.text);this.usedLetterSetsThisSession.has(y)||c.push(m)}c.length>0?(n=l[u(c)].text,r=!0):l.length>0&&(n=l[0].text,r=!0)}if(r&&n){const m=this.getCanonicalLetters(n);this.usedBaseWordsThisSession.add(n),this.usedLetterSetsThisSession.add(m)}this.base=n||"ERROR",o=n,this.base!=="ERROR"&&(this.base=Pt(this.base.split("")).join(""));let g=[];if(this.base!=="ERROR"){this.allPotentialSolutions=Ti(this.base,this.fullWordList);const m=this.selectedDifficulty===C.Easy?[1,2]:this.selectedDifficulty===C.Medium?[1,2,3]:this.selectedDifficulty===C.Hard?[2,3,4]:[1,2,3,4],S=this.allPotentialSolutions.filter(x=>x.text.length<i?!1:m.includes(x.rarity)),y=new Map;for(const x of S)y.has(x.text)||y.set(x.text,x);const B=Array.from(y.values()).sort((x,R)=>x.text.length!==R.text.length?R.text.length-x.text.length:x.rarity!==R.rarity?x.rarity-R.rarity:x.text.localeCompare(R.text));if(B.length>e&&(B.length=e),g=[...B],o){const x=o.toLowerCase();if(!g.some(R=>R.text===x)){const R=this.roots.find(T=>T.text===x)??this.fullWordList.find(T=>T.text===x)??{text:x,rarity:0,pos:"",definition:"",sentence:"",avgSubLen:0,countGE3:0,countGE4:0,countGE5:0,easyValidCount:0,mediumValidCount:0,hardValidCount:0};R.text.length>=i&&g.push(R)}}const E=Math.min(Ht,e);if(g.length<E){const x=new Set(g.map(T=>T.text)),R=this.allPotentialSolutions.filter(T=>T.text.length>=i&&!x.has(T.text)).sort((T,f)=>T.text.length!==f.text.length?f.text.length-T.text.length:T.rarity!==f.rarity?T.rarity-f.rarity:T.text.localeCompare(f.text));for(const T of R)if(g.push(T),x.add(T.text),g.length>=E)break}}else this.allPotentialSolutions=[];this.solutions=g,this.sorted=Ai(this.solutions),this.grid=this.sorted.map(m=>Array(m.text.length).fill("_")),this.found.clear(),this.foundBonusWords.clear(),this.letterAnims=[],this.scoreFlourishes=[],this.hintPointAnims=[],this.gridFlourishes=[],this.gameState=$.Playing,this.bonusWordsCacheIsValid=!1,this.bonusWordsPopupScrollOffset=0,this.currentPuzzleIndex===0&&this.isInSession?(this.currentScore=0,this.wordsSolvedSinceHint=0):this.isInSession&&(this.wordsSolvedSinceHint=0),this.updateLayout()}updateLayout(){this.updateMenuLayout(),this.updateGridLayout(),this.updateWheelLayout(),this.updateHintLayout(),this.updateTopBarLayout()}updateMenuLayout(){const e=this.scale(36)+10,i=dt+U*2+Ee,n=3,o=U*2+e+n*J+(n-1)*st+Gt,r=(N-i)/2,l=(H-o)/2;this.mainMenuButtons=[];for(let u=0;u<n;u+=1){const g=r+U,m=l+U+e+u*(J+st);this.mainMenuButtons.push({x:g,y:m,width:dt,height:J})}const a=4,d=U*2+e+a*J+(a-1)*st+Gt,c=(H-d)/2;this.casualMenuButtons=[];for(let u=0;u<a;u+=1){const g=r+U,m=c+U+e+u*(J+st);this.casualMenuButtons.push({x:g,y:m,width:dt,height:J})}}updateGridLayout(){const t=nt.x+zt,e=nt.y+kt,i=nt.width-2*zt,n=nt.height-2*kt,o=this.sorted.length||1;let r=1,l=o,a=1;if(this.sorted.length>0){const d=Math.min(8,o);let c=1,u=o,g=Number.POSITIVE_INFINITY;for(let p=1;p<=d;p+=1){const _=Math.ceil(o/p),M=Array(p).fill(0);for(let b=0;b<o;b+=1){const D=Math.floor(b/_);M[D]=Math.max(M[D],this.sorted[b].text.length)}let Q=0;for(const b of M){const D=b*(W+z)-(b>0?z:0);Q+=Math.max(0,D)}Q+=(p-1)*ut,Q<g&&(g=Q,c=p,u=_)}r=c,l=u;const m=5;l>m&&(l=m,r=Math.ceil(o/l)),this.colMaxLen=Array(r).fill(0);for(let p=0;p<o;p+=1){const _=Math.min(r-1,Math.floor(p/l));this.colMaxLen[_]=Math.max(this.colMaxLen[_],this.sorted[p].text.length)}let S=0;for(let p=0;p<r;p+=1){const _=this.colMaxLen[p],M=_*(W+z)-(_>0?z:0);S+=Math.max(0,M)}S+=(r-1)*ut;const y=l*(W+z)-(l>0?z:0),B=S>0?Math.min(1,i/S):1,E=y>0?Math.min(1,n/y):1;a=Math.min(B,E);const x=W*a,R=z*a,T=ut*a;this.colXOffset=[];let f=0;for(let p=0;p<r;p+=1){this.colXOffset[p]=f;const _=this.colMaxLen[p],M=_*(x+R)-(_>0?R:0);f+=Math.max(0,M)+T}const I=f-(r>0?T:0),A=l*(x+R)-(l>0?R:0);this.gridStartX=t+(i-I)/2,this.gridStartY=e+(n-A)/2;for(let p=0;p<this.colXOffset.length;p+=1)this.colXOffset[p]+=this.gridStartX;this.wordCol=[],this.wordRow=[];for(let p=0;p<o;p+=1){const _=Math.min(r-1,Math.floor(p/l)),M=p%l;this.wordCol[p]=_,this.wordRow[p]=M}}this.currentGridLayoutScale=a}updateWheelLayout(){const t=mt.x+pt,e=mt.y+pt,i=mt.width-2*pt,n=mt.height-2*pt;this.wheelCenter={x:t+i/2,y:e+n/2};const o=Math.min(i/2,n/2);if(this.currentWheelRadius=Math.max(Math.min(o,Xt),ri*1.5),this.base.length>0){let a=Math.PI*this.currentWheelRadius/this.base.length;a*=.75;const d=this.currentWheelRadius/Xt,c=St*d;let u=Math.min(a,c);const g=this.currentWheelRadius*li,m=this.currentWheelRadius*hi;u=Y(u,g,m),this.currentLetterRenderRadius=Math.max(u,5)}else this.currentLetterRenderRadius=St;this.letterPositionRadius=Math.max(this.currentWheelRadius,this.currentLetterRenderRadius*.5,this.currentWheelRadius*.3);const r=this.currentLetterRenderRadius/St;if(this.visualBgRadius=this.letterPositionRadius+this.currentLetterRenderRadius+oi*r,this.wheelLetterRenderPos=[],this.base.length>0){const a=Math.PI*2/this.base.length;for(let d=0;d<this.base.length;d+=1){const c=d*a-Math.PI/2;this.wheelLetterRenderPos.push({x:this.wheelCenter.x+this.letterPositionRadius*Math.cos(c),y:this.wheelCenter.y+this.letterPositionRadius*Math.sin(c)})}}const l=pe;this.scrambleButton={x:this.wheelCenter.x+fe,y:this.wheelCenter.y+ge-l/2,width:l,height:l},this.continueButton={x:this.wheelCenter.x-100,y:this.wheelCenter.y+this.visualBgRadius+me,width:200,height:50}}updateHintLayout(){this.hintClickableRegions=[];const t=Dt,e=Jt.length,i=Mi,n=this.images.hintFrame,o=n?.naturalWidth||n?.width||0,r=n?.naturalHeight||n?.height||0,l=Mt;let a=t.y+$t+l+bi;const d=Math.max(0,t.width-Ci*2),c=Math.max(0,t.y+t.height-a-vi);if(d<=0||c<=0)return;let u=d,g=(c-(e-1)*i)/Math.max(1,e);if(o>0&&r>0){let S=d/o,y=r*S,B=o*S;if(e*y+(e-1)*i>c&&c>0){const x=(c-(e-1)*i)/e,R=Math.max(x,Kt);S=R/r,B=o*S,y=R}u=B,g=y}else g=Math.max(g,Kt);const m=t.x+(t.width-u)/2;for(let S=0;S<e;S+=1)this.hintClickableRegions.push({x:m,y:a,width:u,height:g}),a+=g+i}updateTopBarLayout(){this.returnToMenuButton={x:Lt.x+Re,y:Lt.y+(Lt.height-Ft)/2,width:Le,height:Ft}}renderMainMenu(t){const e="Word Puzzle",i=[{label:"Casual",rect:this.mainMenuButtons[0]},{label:"Competitive",rect:this.mainMenuButtons[1],disabled:!0},{label:"Quit",rect:this.mainMenuButtons[2]}];this.drawMenuPanel(t,e,i)}renderCasualMenu(t){const e="Select Difficulty",i=[{label:"Easy",rect:this.casualMenuButtons[0]},{label:"Medium",rect:this.casualMenuButtons[1]},{label:"Hard",rect:this.casualMenuButtons[2]},{label:"Return",rect:this.casualMenuButtons[3]}];this.drawMenuPanel(t,e,i)}renderSessionComplete(t){t.save(),t.fillStyle=P({r:0,g:0,b:0,a:150}),t.fillRect(0,0,N,H),t.restore();const e=`Final Score: ${this.currentScore}`;et(t,e,{x:N/2,y:H*.3},{r:255,g:255,b:0,a:255},this.font(48,!0)),this.renderCelebrationEffects(t);const i=200,n=50,o=N/2-i/2,r=H*.8-n/2;this.continueButton={x:o,y:r,width:i,height:n};const l=v(this.continueButton,this.mousePos);this.drawButton(t,this.continueButton,"Continue",l?this.currentTheme.menuButtonHover:this.currentTheme.menuButtonNormal,K)}renderGameScreen(t){if(this.renderTopBar(t),this.renderScoreZone(t),this.renderGrid(t),this.renderPath(t),this.renderWheel(t),this.renderLetterAnims(t),this.renderScoreFlourishes(t),this.renderHintPointAnims(t),this.renderGuessDisplay(t),this.renderHintZone(t),this.renderSolvedWordPopup(t),this.gameState===$.Solved||this.currentScreen===L.GameOver){const e="Puzzle Solved!",i=this.font(24,!0);t.save(),t.font=i;const n=t.measureText(e),o=(n.actualBoundingBoxAscent??0)+(n.actualBoundingBoxDescent??0)||24;t.restore();const r=260,l=75,a=Math.max(n.width,r)+50,d=o+l+70,c=N/2-a/2,u=H/2-d/2;this.images.menuBackground?t.drawImage(this.images.menuBackground,c,u,a,d):k(t,c,u,a,d,15,this.currentTheme.solvedOverlayBg,this.currentTheme.menuButtonHover,1),et(t,e,{x:N/2,y:u+24+o/2},K,i),this.continueButton={x:N/2-r/2,y:u+o+35,width:r,height:l};const g=v(this.continueButton,this.mousePos);this.drawButton(t,this.continueButton,"Continue",g?this.currentTheme.menuButtonHover:this.currentTheme.menuButtonNormal,K)}}renderTopBar(t){if(this.currentScreen!==L.Playing&&this.currentScreen!==L.GameOver)return;const e=v(this.returnToMenuButton,this.mousePos);this.drawButton(t,this.returnToMenuButton,"Menu",e?this.currentTheme.menuButtonHover:this.currentTheme.menuButtonNormal)}renderScoreZone(t){const e=ni,i={x:e.x+e.width/2,y:e.y+ui};et(t,"SCORE:",i,X,this.font(Vt,!0));const n=i.y+ci+Vt,o=this.scoreFlourishTimer>0?1+Fe*Math.sin((ft-this.scoreFlourishTimer)/ft*Math.PI):1;if(t.save(),t.translate(e.x+e.width/2,n+Yt/2),t.scale(o,o),t.fillStyle=P(X),t.font=this.font(Yt,!0),t.textAlign="center",t.textBaseline="middle",t.fillText(`${this.currentScore}`,0,0),t.restore(),this.isInSession){const l=e.width-90,a=Ie,d=e.x+45,c=e.y+e.height-a-40,u=this.puzzlesPerSession>0?(this.currentPuzzleIndex+1)/this.puzzlesPerSession:0;k(t,d,c,l,a,4,{r:50,g:50,b:50,a:150},this.currentTheme.scoreTextLabel,1),t.fillStyle=P(X),t.fillRect(d,c,l*u,a),et(t,`${this.currentPuzzleIndex+1}/${this.puzzlesPerSession}`,{x:d+l/2,y:c+a/2},X,this.font(12,!0))}}renderGrid(t){if(this.sorted.length===0)return;const e=W*this.currentGridLayoutScale,i=z*this.currentGridLayoutScale,n=this.images.gridButton;for(let o=0;o<this.sorted.length;o+=1)for(let r=0;r<this.sorted[o].text.length;r+=1){const l=this.tilePos(o,r);if(n?t.drawImage(n,l.x,l.y,e,e):k(t,l.x,l.y,e,e,4,this.currentTheme.gridEmptyTile),!(this.grid[o]?.[r]!=="_")){const u=this.sorted[o].rarity,g=u===2?this.images.sapphire:u===3?this.images.ruby:u===4?this.images.diamond:null;if(g){const m=e*.6;t.drawImage(g,l.x+e/2-m/2,l.y+e/2-m/2,m,m)}continue}if(this.letterAnims.some(u=>u.target===rt.Grid&&u.wordIdx===o&&u.charIdx===r&&u.t<1))continue;let c=1;for(const u of this.gridFlourishes)if(u.wordIdx===o&&u.charIdx===r){const g=(.6-u.timer)/.6;c=1+.4*Math.sin(g*Math.PI);break}t.save(),t.translate(l.x+e/2,l.y+e/2),t.scale(c,c),t.fillStyle=P(X),t.font=this.font(Math.max(8,20*this.currentGridLayoutScale),!0),t.textAlign="center",t.textBaseline="middle",t.fillText(this.grid[o][r],0,0),t.restore()}if(this.colXOffset.length>=2){const r=ce*(e+i)-i;for(let l=0;l<this.colXOffset.length-1;l+=1){const a=this.colXOffset[l+1]-ut*this.currentGridLayoutScale/2;t.fillStyle="rgba(120,100,80,0.8)",t.fillRect(a-Nt/2,this.gridStartY,Nt,r)}}}renderPath(t){if(!this.dragging||this.path.length===0)return;const e=this.wheelTouchScaleActive?ot:1;t.strokeStyle=P(X),t.lineWidth=5*e,t.lineCap="round",t.beginPath();for(let i=0;i<this.path.length;i+=1){const n=this.getWheelLetterPosition(this.path[i],e);n&&(i===0?t.moveTo(n.x,n.y):t.lineTo(n.x,n.y))}t.lineTo(this.mousePos.x,this.mousePos.y),t.stroke()}renderWheel(t){if(!this.base)return;const e=this.images.circularLetterFrame,i=this.wheelTouchScaleActive?ot:1,n=this.currentLetterRenderRadius*Rt*i,o=Y(this.currentLetterRenderRadius/St*Rt,.5,2),r=Math.max(8,ai*o*i);for(let l=0;l<this.base.length;l+=1){const a=this.getWheelLetterPosition(l,i);if(a){if(e){const d=n*2;t.drawImage(e,a.x-d/2,a.y-d/2,d,d)}else t.beginPath(),t.arc(a.x,a.y,n,0,Math.PI*2),t.fillStyle=P(this.currentTheme.letterCircleNormal),t.fill(),t.strokeStyle=P(this.currentTheme.wheelOutline),t.lineWidth=2*i,t.stroke();t.fillStyle=P(X),t.font=this.font(r,!0),t.textAlign="center",t.textBaseline="middle",t.fillText(this.base[l].toUpperCase(),a.x,a.y)}}this.images.scrambleButton&&t.drawImage(this.images.scrambleButton,this.scrambleButton.x,this.scrambleButton.y,this.scrambleButton.width,this.scrambleButton.height)}renderLetterAnims(t){const e=Math.max(8,20*this.uiScale);for(const i of this.letterAnims){if(i.t<0)continue;const n=Y(i.t,0,1),o=n*n*(3-2*n),r=Tt(i.start.x,i.end.x,o),l=Tt(i.start.y,i.end.y,o),a=n>.7?(1-n)/.3:1;t.fillStyle=`rgba(255, 190, 70, ${a})`,t.font=this.font(e,!0),t.textAlign="center",t.textBaseline="middle",t.fillText(i.ch,r,l)}}renderScoreFlourishes(t){const e=Math.max(8,ve*this.uiScale);for(const i of this.scoreFlourishes)t.fillStyle=P(i.color),t.font=this.font(e,!0),t.textAlign="center",t.textBaseline="middle",t.fillText(i.textString,i.position.x,i.position.y)}renderHintPointAnims(t){for(const i of this.hintPointAnims)t.fillStyle=P(i.color),t.font=this.font(20,!0),t.textAlign="center",t.textBaseline="middle",t.fillText(i.textString,i.currentPosition.x,i.currentPosition.y)}renderGuessDisplay(t){if(!this.currentGuess)return;const e=this.currentGuess.length,i=W*this.currentGridLayoutScale*1.25,n=z*this.currentGridLayoutScale,o=e*i+(e-1)*n,r=this.wheelTouchScaleActive?ot:1,a=this.wheelCenter.y-this.visualBgRadius*r-i-ae-ue,d=this.wheelCenter.x-o/2,c=this.images.gridButton;for(let u=0;u<e;u+=1){const g=d+u*(i+n);c?t.drawImage(c,g,a,i,i):k(t,g,a,i,i,4,this.currentTheme.gridEmptyTile),t.fillStyle=P(X),t.font=this.font(Math.max(8,i*.65),!0),t.textAlign="center",t.textBaseline="middle",t.fillText(this.currentGuess[u],g+i/2,a+i/2)}}renderHintZone(t){const e=Dt,i=this.calculateTotalPossibleBonusWords(),n=`Bonus Words: ${this.foundBonusWords.size}/${i}`;t.font=this.font(Mt,!0),t.fillStyle=P(X),t.textAlign="left",t.textBaseline="top";const o=t.measureText(n).width,r=t.measureText(n),l=(r.actualBoundingBoxAscent??0)+(r.actualBoundingBoxDescent??0)||Mt,a=e.x+(e.width-o)/2,d=e.y+$t;t.fillText(n,a,d),this.bonusWordsTextRect={x:a,y:d,width:o,height:l};for(let c=0;c<this.hintClickableRegions.length;c+=1){const u=this.hintClickableRegions[c],m=this.hoveredHintIndex===c?this.currentTheme.menuButtonHover:this.currentTheme.menuButtonNormal,S=this.images.hintFrame,y=S?.naturalWidth||S?.width||u.width,B=S?.naturalHeight||S?.height||u.height,E=y>0?u.width/y:1;this.images.hintFrame?(t.drawImage(this.images.hintFrame,u.x,u.y,u.width,u.height),this.hintFrameClickAnimTimers[c]>0&&(t.fillStyle="rgba(0,255,0,0.2)",t.fillRect(u.x,u.y,u.width,u.height))):k(t,u.x,u.y,u.width,u.height,6,m);const x=Jt[c],R=At[c],T=Math.max(8,_i*E);t.fillStyle=P(X),t.font=this.font(T,!0),t.textAlign="left",t.textBaseline="middle";const f=u.x+y*Ii*E,I=u.y+B*Li*E;if(t.fillText(x,f,I),this.images.hintIndicator){const A=B*Pi*E,p=u.x+y*Ri*E,_=u.y+B*Ei*E;t.globalAlpha=this.hintPoints>=R?1:.3,t.drawImage(this.images.hintIndicator,p-A/2,_-A/2,A,A),t.globalAlpha=1}}if(this.hoveredHintIndex>=0){const c=this.hintClickableRegions[this.hoveredHintIndex],u=c.x+c.width+10,g=c.y;this.images.menuBackground?t.drawImage(this.images.menuBackground,u,g,_t,It):k(t,u,g,_t,It,8,this.currentTheme.menuBg,this.currentTheme.menuButtonHover,1);const m=Ni[this.hoveredHintIndex],S=Ge,y=_t-S*2,B=It-S*2,E=14,x=12,R=We,T=A=>{const p=Math.max(8,E*A),_=Math.max(8,x*A),M=R*A;t.font=this.font(_);const b=qt(t,m,y).split(`
`).filter(xt=>xt.length>0),D=["Available Points:",`${this.hintPoints}`,`Cost: ${At[this.hoveredHintIndex]}`],lt=D.length*p+Math.max(0,D.length-1)*M,V=b.length*_+Math.max(0,b.length-1)*M,j=lt+(b.length>0?M+V:0);return{headerFont:p,descFont:_,spacing:M,descLines:b,headerLines:D,headerHeight:lt,totalHeight:j}};let f=T(1);if(f.totalHeight>B){const A=Math.max(.6,B/f.totalHeight);f=T(A)}if(f.totalHeight>B&&f.descLines.length>0){const A=B-(f.headerHeight+f.spacing),p=f.descFont+f.spacing,_=Math.max(1,Math.floor((A+f.spacing)/p));f.descLines=f.descLines.slice(0,_)}t.fillStyle=P(K),t.textAlign="left",t.textBaseline="top";let I=g+S;t.font=this.font(f.headerFont,!0);for(let A=0;A<f.headerLines.length;A+=1)t.fillText(f.headerLines[A],u+S,I),I+=f.headerFont,A<f.headerLines.length-1&&(I+=f.spacing);if(f.descLines.length>0){I+=f.spacing,t.font=this.font(f.descFont);for(let A=0;A<f.descLines.length;A+=1)t.fillText(f.descLines[A],u+S,I),I+=f.descFont,A<f.descLines.length-1&&(I+=f.spacing)}}}renderBonusWordsPopup(t){const e=nt,i=e.width*ti,n=e.height*ei,o=e.x+(e.width-i)/2,r=e.y+(e.height-n)/2;this.images.menuBackground?t.drawImage(this.images.menuBackground,o,r,i,n):k(t,o,r,i,n,$e,this.currentTheme.menuBg,this.currentTheme.menuButtonHover,1);const l=this.buildBonusWordGroups();if(l.length===0)return;const a=i-gt*2,d=n-gt*2,c=f=>{const I=Math.max(5,qe*f),A=Math.max(7,je*f),p=Ve*f,_=Ye*f,M=Ze*f,Q=Qe*f,b=l.map(V=>{t.font=this.font(A,!0);const j=t.measureText(V.title).width,xt=A;t.font=this.font(I);let ht=0;const tt=V.words.map(F=>{const at=F.found?F.text.toUpperCase():"*".repeat(F.text.length);return ht=Math.max(ht,t.measureText(at).width),{text:at,color:F.found?this.currentTheme.hudTextFound:this.currentTheme.menuButtonText}});let q=1;tt.length>=15?q=Ut:tt.length>=6&&(q=Math.min(2,Ut));const yt=Array.from({length:q},()=>[]),ne=Math.floor(tt.length/q),oe=tt.length%q;let wt=0;for(let F=0;F<q;F+=1){const at=ne+(F<oe?1:0);for(let Ot=0;Ot<at&&!(wt>=tt.length);Ot+=1)yt[F].push(tt[wt]),wt+=1}const vt=yt.map(F=>F.length===0?0:F.length*I+(F.length-1)*Q),bt=vt.length?Math.max(...vt):0,re=q*ht+(q-1)*_,le=Math.max(j,re),he=xt+M+bt;return{title:V.title,totalWidth:le,totalHeight:he,wordsHeight:bt,wordColumnWidth:Math.max(ht,1),columns:yt}}),D=b.reduce((V,j)=>V+j.totalWidth,0)+Math.max(0,b.length-1)*p,lt=b.reduce((V,j)=>Math.max(V,j.totalHeight),0);return{layouts:b,totalWidth:D,maxGroupHeight:lt,wordFontSize:I,titleFontSize:A,majorSpacing:p,minorSpacing:_,titleBottomMargin:M,wordLineSpacing:Q}};let u=c(1),g=1;u.totalWidth>0&&a>0&&(g=Math.min(g,a/u.totalWidth)),u.maxGroupHeight>0&&d>0&&(g=Math.min(g,d/u.maxGroupHeight)),g=Y(g,Je,Ke),g!==1&&(u=c(g));const m=o+(i-u.totalWidth)/2,S=r+gt;t.textAlign="center",t.textBaseline="top",t.font=this.font(u.titleFontSize,!0),t.fillStyle=P(K);let y=m;for(const f of u.layouts){const I=y+f.totalWidth/2;t.fillText(f.title,I,S),y+=f.totalWidth+u.majorSpacing}const B=u.titleFontSize+u.titleBottomMargin,E=gt+B,x=Math.max(1,n-E-si),R=u.layouts.reduce((f,I)=>Math.max(f,I.wordsHeight),0);this.bonusWordsPopupMaxScrollOffset=Math.max(0,R-x),this.bonusWordsPopupScrollOffset=Y(this.bonusWordsPopupScrollOffset,0,this.bonusWordsPopupMaxScrollOffset);const T=r+E-this.bonusWordsPopupScrollOffset;t.save(),t.beginPath(),t.rect(o,r+E,i,x),t.clip(),t.font=this.font(u.wordFontSize),t.textAlign="center",t.textBaseline="top",y=m;for(const f of u.layouts){let I=y;for(const A of f.columns){let p=T;for(let _=0;_<A.length;_+=1){t.fillStyle=P(K);const M=I+f.wordColumnWidth/2;t.fillText(A[_].text,M,p),p+=u.wordFontSize,_<A.length-1&&(p+=u.wordLineSpacing)}I+=f.wordColumnWidth+u.minorSpacing}y+=f.totalWidth+u.majorSpacing}t.restore()}renderSolvedWordPopup(t){if(this.hoveredSolvedWordIndex<0)return;const e=this.sorted[this.hoveredSolvedWordIndex];if(!e)return;const i=De,n=Ue,o=ze,r=Math.max(120,n-i*2),l=Math.max(10,16),a=Math.max(8,14),c=[{text:`Word: ${e.text}`,fontSize:l,bold:!0,color:{r:230,g:230,b:230,a:255}},{text:`POS: ${e.pos?e.pos:"N/A"}`,fontSize:a,bold:!1,color:{r:200,g:210,b:220,a:255}},{text:`Definition: ${e.definition?e.definition:"N/A"}`,fontSize:a,bold:!1,color:{r:190,g:200,b:210,a:255}},{text:`Sentence: ${e.sentence?e.sentence:"N/A"}`,fontSize:a,bold:!1,color:{r:190,g:200,b:210,a:255}}].map(T=>{t.font=this.font(T.fontSize,T.bold);const I=qt(t,T.text,r).split(`
`),A=I.reduce((_,M)=>Math.max(_,t.measureText(M).width),0),p=I.length*T.fontSize+Math.max(0,I.length-1)*o;return{...T,lines:I,width:A,height:p}}),u=c.reduce((T,f)=>Math.max(T,f.width),0),g=Math.min(n,u+i*2),m=c.reduce((T,f)=>T+f.height,0)+o*Math.max(0,c.length-1)+i*2,S=ke,y=Xe;let B=this.mousePos.x+S,E=this.mousePos.y+S;B+g>N-y&&(B=N-g-y),E+m>H-y&&(E=H-m-y),B=Math.max(B,y),E=Math.max(E,y),t.save(),this.images.menuBackground?t.drawImage(this.images.menuBackground,B,E,g,m):k(t,B,E,g,m,8,this.currentTheme.menuBg,this.currentTheme.menuButtonHover,1);let x=E+i;const R=B+i;t.textAlign="left",t.textBaseline="top";for(let T=0;T<c.length;T+=1){const f=c[T];t.font=this.font(f.fontSize,f.bold),t.fillStyle=P(K);let I=x;for(const A of f.lines)t.fillText(A,R,I),I+=f.fontSize+o;x+=f.height+(T<c.length-1?o:0)}t.restore()}buildBonusWordLines(){if(!this.bonusWordsCacheIsValid){const i=new Map;for(const n of this.allPotentialSolutions)this.isGridSolution(n.text)||i.set(n.text,n);this.cachedBonusWords=Array.from(i.values()).sort((n,o)=>n.text.length!==o.text.length?n.text.length-o.text.length:n.text.localeCompare(o.text)),this.bonusWordsCacheIsValid=!0}const t=[];let e=0;for(const i of this.cachedBonusWords){i.text.length!==e&&(e=i.text.length,t.push({text:`${e}-Letter Words:`,found:!0,isHeader:!0}));const n=this.foundBonusWords.has(i.text);t.push({text:n?i.text.toUpperCase():"*".repeat(i.text.length),found:n,isHeader:!1})}return t}buildBonusWordGroups(){if(!this.bonusWordsCacheIsValid){const e=new Map;for(const i of this.allPotentialSolutions)this.isGridSolution(i.text)||e.set(i.text,i);this.cachedBonusWords=Array.from(e.values()).sort((i,n)=>i.text.length!==n.text.length?i.text.length-n.text.length:i.text.localeCompare(n.text)),this.bonusWordsCacheIsValid=!0}const t=new Map;for(const e of this.cachedBonusWords){const i=this.foundBonusWords.has(e.text),n=t.get(e.text.length);n?n.push({text:e.text,found:i}):t.set(e.text.length,[{text:e.text,found:i}])}return Array.from(t.entries()).sort(([e],[i])=>e-i).map(([e,i])=>({length:e,title:`${e}-Letter Words:`,words:i}))}drawMenuPanel(t,e,i){if(i.length===0)return;const n=i[0].rect.x-U,o=i[0].rect.y-U-40,r=dt+U*2,l=U*2+40+i.length*J+(i.length-1)*st;this.images.menuBackground?t.drawImage(this.images.menuBackground,n,o,r,l):k(t,n,o,r,l,12,this.currentTheme.menuBg),et(t,e,{x:n+r/2,y:o+24},this.currentTheme.menuTitleText,this.font(24,!0));for(const a of i){const d=!a.disabled&&v(a.rect,this.mousePos);a.disabled&&(t.save(),t.globalAlpha=.45),this.drawButton(t,a.rect,a.label,d?this.currentTheme.menuButtonHover:this.currentTheme.menuButtonNormal),a.disabled&&t.restore()}}drawButton(t,e,i,n,o=this.currentTheme.menuButtonText){this.images.menuButton?t.drawImage(this.images.menuButton,e.x,e.y,e.width,e.height):k(t,e.x,e.y,e.width,e.height,8,n),et(t,i,{x:e.x+e.width/2,y:e.y+e.height/2},o,this.font(18,!0))}updateLetterAnims(t){this.letterAnims=this.letterAnims.filter(e=>{if(e.t+=t*3,e.t>=1){if(e.t=1,e.target===rt.Grid){const i=this.grid[e.wordIdx];i&&e.charIdx>=0&&e.charIdx<i.length&&(i[e.charIdx]=e.ch,this.checkWordCompletion(e.wordIdx)),this.playSound("place")}return!1}return!0})}updateScoreFlourishes(t){this.scoreFlourishes=this.scoreFlourishes.filter(e=>{if(e.position={x:e.position.x+e.velocity.x*t,y:e.position.y+e.velocity.y*t},e.lifetime-=t,e.lifetime<=0)return!1;const i=Y(e.lifetime/e.initialLifetime,0,1);return e.color={...e.color,a:i*255},!0})}updateHintPointAnims(t){this.hintPointAnims=this.hintPointAnims.filter(e=>{e.t+=t*e.speed;const i=Y(e.t,0,1);return e.currentPosition={x:Tt(e.startPosition.x,e.targetPosition.x,i),y:Tt(e.startPosition.y,e.targetPosition.y,i)},e.t<1})}spawnScoreFlourish(t,e){if(t===0)return;const i=this.sorted[e]?.text;if(!i)return;const n=this.tilePos(e,0),o=this.tilePos(e,i.length-1),r=W*this.currentGridLayoutScale*(this.currentGridLayoutScale<1?Bt:1),l={x:(n.x+o.x)/2+r/2,y:n.y-r*.5},a=w(be,Oe);this.scoreFlourishes.push({textString:`+${t}`,position:l,velocity:{x:w(-Wt,Wt),y:w(He,Ne)},lifetime:a,initialLifetime:a,color:{r:255,g:215,b:0,a:255}})}spawnHintPointAnimation(t,e){const i={x:t.x+t.width/2,y:t.y},n={x:t.x+t.width/2,y:t.y-24};this.hintPointAnims.push({textString:`+${e}`,currentPosition:i,startPosition:i,targetPosition:n,color:{r:255,g:255,b:0,a:255},t:0,speed:.8})}activateHint(t){if(this.gameState===$.Solved){this.playSound("error");return}let e=!1;for(let o=0;o<this.grid.length;o+=1)if(!this.found.has(this.sorted[o].text)&&this.grid[o].some(r=>r==="_")){e=!0;break}if(!e){this.playSound("error");return}const i=[];if(t===Z.RevealFirst){for(let o=0;o<this.grid.length;o+=1)if(!this.found.has(this.sorted[o].text)){for(let r=0;r<this.grid[o].length;r+=1)if(this.grid[o][r]==="_"){i.push({wordIdx:o,charIdx:r,letter:this.sorted[o].text[r]});break}if(i.length)break}}else if(t===Z.RevealRandom)for(let o=0;o<this.grid.length;o+=1){if(this.found.has(this.sorted[o].text))continue;const r=this.grid[o].map((l,a)=>l==="_"?a:-1).filter(l=>l>=0);if(r.length>0){const l=r[Math.floor(Math.random()*r.length)];i.push({wordIdx:o,charIdx:l,letter:this.sorted[o].text[l]})}}else if(t===Z.RevealLast){for(let o=this.grid.length-1;o>=0;o-=1)if(!this.found.has(this.sorted[o].text)){for(let r=0;r<this.grid[o].length;r+=1)this.grid[o][r]==="_"&&i.push({wordIdx:o,charIdx:r,letter:this.sorted[o].text[r]});if(i.length)break}}else if(t===Z.RevealFirstOfEach)for(let o=0;o<this.grid.length;o+=1){if(this.found.has(this.sorted[o].text))continue;const r=this.grid[o].findIndex(l=>l==="_");r>=0&&i.push({wordIdx:o,charIdx:r,letter:this.sorted[o].text[r]})}if(i.length===0){this.playSound("error");return}this.playSound("hintUsed");let n=0;for(const o of i){const r=this.tilePos(o.wordIdx,o.charIdx),l=W*this.currentGridLayoutScale*(this.currentGridLayoutScale<1?Bt:1);let a=this.wheelCenter;for(let d=0;d<this.base.length;d+=1)if(this.base[d].toUpperCase()===o.letter.toUpperCase()){a=this.wheelLetterRenderPos[d]??a;break}this.letterAnims.push({ch:o.letter.toUpperCase(),start:a,end:{x:r.x+l/2,y:r.y+l/2},t:n,wordIdx:o.wordIdx,charIdx:o.charIdx,target:rt.Grid}),n-=.03}}checkWordCompletion(t){if(!this.grid[t]||!this.sorted[t])return;const e=this.sorted[t].text;if(this.found.has(e)||this.grid[t].some(n=>n==="_"))return;if(this.grid[t].join("").toUpperCase()===e.toUpperCase()){this.found.add(e);const n=e.length*10,o=this.sorted[t].rarity>1?this.sorted[t].rarity*25:0,r=n+o;this.currentScore+=r,this.spawnScoreFlourish(r,t),this.scoreFlourishTimer=ft,this.found.size===this.solutions.length&&(this.gameState=$.Solved,this.currentScreen=L.GameOver,this.playSound("win"))}}tilePos(t,e){const i=W*this.currentGridLayoutScale,n=z*this.currentGridLayoutScale,o=this.wordCol[t]??0,r=this.wordRow[t]??0,l=(this.colXOffset[o]??this.gridStartX)+e*(i+n),a=this.gridStartY+r*(i+n);return{x:l,y:a}}calculateTotalPossibleBonusWords(){return this.allPotentialSolutions.filter(t=>!this.isGridSolution(t.text)).length}isGridSolution(t){return this.solutions.some(e=>e.text===t)}startCelebrationEffects(){this.celebrationTimer=0,this.confetti=[];for(let t=0;t<100;t+=1)this.confetti.push({position:{x:w(0,N),y:w(0,H)},velocity:{x:w(-30,30),y:w(20,80)},angularVelocity:w(-3,3),lifetime:w(2,4),initialLifetime:w(2,4),rotation:w(0,Math.PI*2),size:{x:w(4,8),y:w(6,12)},color:{r:w(50,255,!0),g:w(50,255,!0),b:w(50,255,!0),a:255}})}updateCelebrationEffects(t){this.currentScreen===L.SessionComplete&&(this.celebrationTimer+=t,this.confetti=this.confetti.filter(e=>(e.position={x:e.position.x+e.velocity.x*t,y:e.position.y+e.velocity.y*t},e.rotation+=e.angularVelocity*t,e.lifetime-=t,e.lifetime>0)))}renderCelebrationEffects(t){for(const e of this.confetti)t.save(),t.translate(e.position.x,e.position.y),t.rotate(e.rotation),t.fillStyle=P(e.color),t.fillRect(-e.size.x/2,-e.size.y/2,e.size.x,e.size.y),t.restore()}clearDragState(){this.dragging=!1,this.path=[],this.currentGuess="",this.wheelTouchScaleActive=!1}getCriteriaForCurrentPuzzle(){const t=this.currentPuzzleIndex===this.puzzlesPerSession-1;return this.selectedDifficulty===C.Easy?{allowedLengths:[7],allowedRarities:[1]}:this.selectedDifficulty===C.Medium?{allowedLengths:[7],allowedRarities:[1,2,3]}:this.selectedDifficulty===C.Hard?{allowedLengths:[7],allowedRarities:t?[4]:[3,4]}:{allowedLengths:[4,5,6,7],allowedRarities:[1,2,3,4]}}getCanonicalLetters(t){return t.toLowerCase().split("").sort().join("")}startBackgroundMusic(){if(!this.hasUserInteracted||this.backgroundMusic||O.music.length===0)return;const t=O.music[Math.floor(Math.random()*O.music.length)],e=new Audio(t);e.loop=!0,e.volume=.4,e.play().catch(()=>{}),this.backgroundMusic=e}playSound(t){const e=this.sounds[t];e&&(e.currentTime=0,e.play().catch(()=>{}))}drawBackground(t){const e=this.images.mainBackground;if(!e)return;const i=Math.max(N/e.width,H/e.height),n=e.width*i,o=e.height*i,r=(N-n)/2,l=(H-o)/2;t.drawImage(e,r,l,n,o)}font(t,e=!1){return`${e?"bold ":""}${t}px ${this.fontFamily}, Arial, sans-serif`}scale(t){return t*this.uiScale*de}}const it=document.getElementById("gameCanvas");if(!it)throw new Error("Missing #gameCanvas element.");const ee=it.getContext("2d");if(!ee)throw new Error("Failed to get 2D context.");const Ct=new Hi(it,ee),ie=()=>{const h=window.devicePixelRatio||1,t=it.getBoundingClientRect();it.width=Math.floor(t.width*h),it.height=Math.floor(t.height*h),Ct.onResize(t.width,t.height,h)};window.addEventListener("resize",ie);ie();let te=performance.now();const se=h=>{const t=Math.min(.1,(h-te)/1e3);te=h,Ct.update(t),Ct.render(),requestAnimationFrame(se)};requestAnimationFrame(se);
